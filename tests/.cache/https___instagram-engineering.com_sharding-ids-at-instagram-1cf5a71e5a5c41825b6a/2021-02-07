<!doctype html><html lang="en"><head><script>!function(n,e){var t,o,i,c=[],f={passive:!0,capture:!0},r=new Date,a="pointerup",u="pointercancel";function p(n,c){t||(t=c,o=n,i=new Date,w(e),s())}function s(){o>=0&&o<i-r&&(c.forEach((function(n){n(o,t)})),c=[])}function l(t){if(t.cancelable){var o=(t.timeStamp>1e12?new Date:performance.now())-t.timeStamp;"pointerdown"==t.type?function(t,o){function i(){p(t,o),r()}function c(){r()}function r(){e(a,i,f),e(u,c,f)}n(a,i,f),n(u,c,f)}(o,t):p(o,t)}}function w(n){["click","mousedown","keydown","touchstart","pointerdown"].forEach((function(e){n(e,l,f)}))}w(n),self.perfMetrics=self.perfMetrics||{},self.perfMetrics.onFirstInputDelay=function(n){c.push(n),s()}}(addEventListener,removeEventListener)</script><script defer src="https://cdn.optimizely.com/js/16180790160.js"></script><title data-rh="true">Sharding &amp; IDs at Instagram. With more than 25 photos and 90 likes… | by Instagram Engineering | Instagram Engineering</title><meta data-rh="true" charset="utf-8"/><meta data-rh="true" name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/><meta data-rh="true" name="theme-color" content="#000000"/><meta data-rh="true" name="twitter:app:name:iphone" content="Medium"/><meta data-rh="true" name="twitter:app:id:iphone" content="828256236"/><meta data-rh="true" property="al:ios:app_name" content="Medium"/><meta data-rh="true" property="al:ios:app_store_id" content="828256236"/><meta data-rh="true" property="al:android:package" content="com.medium.reader"/><meta data-rh="true" property="fb:app_id" content="542599432471018"/><meta data-rh="true" property="og:site_name" content="Medium"/><meta data-rh="true" property="og:type" content="article"/><meta data-rh="true" property="article:published_time" content="2016-05-02T18:36:09.745Z"/><meta data-rh="true" name="title" content="Sharding &amp; IDs at Instagram. With more than 25 photos and 90 likes… | by Instagram Engineering | Instagram Engineering"/><meta data-rh="true" property="og:title" content="Sharding &amp; IDs at Instagram"/><meta data-rh="true" property="twitter:title" content="Sharding &amp; IDs at Instagram"/><meta data-rh="true" name="twitter:site" content="@instagrameng"/><meta data-rh="true" name="twitter:app:url:iphone" content="medium://p/1cf5a71e5a5c"/><meta data-rh="true" property="al:android:url" content="medium://p/1cf5a71e5a5c"/><meta data-rh="true" property="al:ios:url" content="medium://p/1cf5a71e5a5c"/><meta data-rh="true" property="al:android:app_name" content="Medium"/><meta data-rh="true" name="description" content="With more than 25 photos and 90 likes every second, we store a lot of data here at Instagram. To make sure all of our important data fits into memory and is available quickly for our users, we’ve…"/><meta data-rh="true" property="og:description" content="With more than 25 photos and 90 likes every second, we store a lot of data here at Instagram. To make sure all of our important data fits…"/><meta data-rh="true" property="twitter:description" content="With more than 25 photos and 90 likes every second, we store a lot of data here at Instagram. To make sure all of our important data fits…"/><meta data-rh="true" property="og:url" content="https://instagram-engineering.com/sharding-ids-at-instagram-1cf5a71e5a5c"/><meta data-rh="true" property="al:web:url" content="https://instagram-engineering.com/sharding-ids-at-instagram-1cf5a71e5a5c"/><meta data-rh="true" name="twitter:card" content="summary"/><meta data-rh="true" property="article:author" content="https://medium.com/@InstagramEng"/><meta data-rh="true" name="author" content="Instagram Engineering"/><meta data-rh="true" name="robots" content="index,follow,max-image-preview:large"/><meta data-rh="true" name="referrer" content="unsafe-url"/><meta data-rh="true" name="twitter:label1" value="Reading time"/><meta data-rh="true" name="twitter:data1" value="5 min read"/><meta data-rh="true" name="parsely-post-id" content="1cf5a71e5a5c"/><link data-rh="true" rel="search" type="application/opensearchdescription+xml" title="Medium" href="/osd.xml"/><link data-rh="true" rel="apple-touch-icon" sizes="152x152" href="https://miro.medium.com/fit/c/152/152/1*sHhtYhaCe2Uc3IU0IgKwIQ.png"/><link data-rh="true" rel="apple-touch-icon" sizes="120x120" href="https://miro.medium.com/fit/c/120/120/1*sHhtYhaCe2Uc3IU0IgKwIQ.png"/><link data-rh="true" rel="apple-touch-icon" sizes="76x76" href="https://miro.medium.com/fit/c/76/76/1*sHhtYhaCe2Uc3IU0IgKwIQ.png"/><link data-rh="true" rel="apple-touch-icon" sizes="60x60" href="https://miro.medium.com/fit/c/60/60/1*sHhtYhaCe2Uc3IU0IgKwIQ.png"/><link data-rh="true" rel="mask-icon" href="https://cdn-static-1.medium.com/_/fp/icons/Medium-Avatar-500x500.svg" color="#171717"/><link data-rh="true" id="glyph_preload_link" rel="preload" as="style" type="text/css" href="https://glyph.medium.com/css/unbound.css"/><link data-rh="true" id="glyph_link" rel="stylesheet" type="text/css" href="https://glyph.medium.com/css/unbound.css"/><link data-rh="true" rel="author" href="https://medium.com/@InstagramEng"/><link data-rh="true" rel="canonical" href="https://instagram-engineering.com/sharding-ids-at-instagram-1cf5a71e5a5c"/><link data-rh="true" rel="alternate" href="android-app://com.medium.reader/https/medium.com/p/1cf5a71e5a5c"/><link data-rh="true" rel="icon" href="https://miro.medium.com/1*m-R_BkNf1Qjr1YbyOIJY2w.png"/><script data-rh="true" type="application/ld+json">{"@context":"http:\u002F\u002Fschema.org","@type":"NewsArticle","image":{"@type":"ImageObject","url":"https:\u002F\u002Fmiro.medium.com\u002Fproxy\u002F1*kFrc4tBFM_tCis-2Ic87WA.png","height":810,"width":1440},"url":"https:\u002F\u002Finstagram-engineering.com\u002Fsharding-ids-at-instagram-1cf5a71e5a5c","dateCreated":"2012-12-30T11:23:00.000Z","datePublished":"2012-12-30T11:23:00.000Z","dateModified":"2018-06-19T03:12:53.551Z","headline":"Sharding & IDs at Instagram - Instagram Engineering","name":"Sharding & IDs at Instagram - Instagram Engineering","description":"With more than 25 photos and 90 likes every second, we store a lot of data here at Instagram. To make sure all of our important data fits into memory and is available quickly for our users, we’ve…","identifier":"1cf5a71e5a5c","keywords":["Lite:true","Tag:Infra","Tag:Open Source","Publication:instagram-engineering","Elevated:false","LockedPostSource:LOCKED_POST_SOURCE_NONE","LayerCake:0"],"author":{"@type":"Person","name":"Instagram Engineering","url":"https:\u002F\u002Finstagram-engineering.com\u002F@InstagramEng"},"creator":["Instagram Engineering"],"publisher":{"@type":"Organization","name":"Instagram Engineering","url":"instagram-engineering.com","logo":{"@type":"ImageObject","width":60,"height":60,"url":"https:\u002F\u002Fmiro.medium.com\u002Fmax\u002F120\u002F1*CPgwLHR6jno_tOmF0--7eg.jpeg"}},"mainEntityOfPage":"https:\u002F\u002Finstagram-engineering.com\u002Fsharding-ids-at-instagram-1cf5a71e5a5c"}</script><script data-rh="true" >(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-24232453-2', 'auto');
ga('send', 'pageview');</script><link rel="preload" href="https://cdn.optimizely.com/js/16180790160.js" as="script"><style type="text/css" data-fela-rehydration="516" data-fela-type="STATIC">html{box-sizing:border-box}*, *:before, *:after{box-sizing:inherit}body{margin:0;padding:0;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;color:rgba(0,0,0,0.8);position:relative;min-height:100vh}h1, h2, h3, h4, h5, h6, dl, dd, ol, ul, menu, figure, blockquote, p, pre, form{margin:0}menu, ol, ul{padding:0;list-style:none;list-style-image:none}main{display:block}a{color:inherit;text-decoration:none}a, button, input{-webkit-tap-highlight-color:transparent}img, svg{vertical-align:middle}button{background:transparent;overflow:visible}button, input, optgroup, select, textarea{margin:0}:root{--reach-tabs:1;--reach-menu-button:1}</style><style type="text/css" data-fela-rehydration="516" data-fela-type="RULE">.a{font-family:medium-content-sans-serif-font, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif}.b{font-weight:400}.c{background-color:rgba(255, 255, 255, 1)}.l{height:100vh}.m{width:100vw}.n{display:flex}.o{align-items:center}.p{justify-content:center}.q{height:25px}.r{fill:rgba(41, 41, 41, 1)}.s{display:block}.t{position:absolute}.u{top:0}.v{left:0}.w{right:0}.x{z-index:500}.y{box-shadow:0 4px 12px 0 rgba(0, 0, 0, 0.05)}.ah{max-width:1192px}.ai{min-width:0}.aj{width:100%}.ak{height:65px}.an{flex:1 0 auto}.ao{fill:rgba(25, 25, 25, 1)}.ap{flex:0 0 auto}.aq{visibility:hidden}.ar{margin-left:16px}.as{color:rgba(26, 137, 23, 1)}.at{fill:rgba(26, 137, 23, 1)}.au{font-size:inherit}.av{border:inherit}.aw{font-family:inherit}.ax{letter-spacing:inherit}.ay{font-weight:inherit}.az{padding:0}.ba{margin:0}.be:disabled{cursor:default}.bf:disabled{color:rgba(163, 208, 162, 0.5)}.bg:disabled{fill:rgba(163, 208, 162, 0.5)}.bh{border-top:1px solid rgba(230, 230, 230, 1)}.bj{height:54px}.bk{overflow:hidden}.bl{margin-right:40px}.bm{height:36px}.bn{width:36px}.bo{overflow:auto}.bp{flex:0 1 auto}.bq{list-style-type:none}.br{line-height:40px}.bs{white-space:nowrap}.bt{overflow-x:auto}.bu{align-items:flex-start}.bv{margin-top:20px}.bw{padding-top:20px}.bx{height:80px}.by{height:20px}.bz{margin-right:15px}.ca{margin-left:15px}.cb:first-child{margin-left:0}.cc{min-width:1px}.cd{background-color:rgba(168, 168, 168, 1)}.ce{font-family:sohne, "Helvetica Neue", Helvetica, Arial, sans-serif}.cf{font-size:13px}.cg{line-height:20px}.ch{color:rgba(117, 117, 117, 1)}.ci{text-transform:uppercase}.cj{letter-spacing:1px}.ck{color:inherit}.cl{fill:inherit}.co:disabled{color:rgba(117, 117, 117, 1)}.cp:disabled{fill:rgba(117, 117, 117, 1)}.cq{margin-bottom:0px}.cr{margin-top:0px}.cs{height:119px}.cv{padding-left:24px}.cw{padding-right:24px}.cx{margin-left:auto}.cy{margin-right:auto}.cz{max-width:728px}.da{box-sizing:border-box}.db{top:calc(100vh + 100px)}.dc{bottom:calc(100vh + 100px)}.dd{width:10px}.de{pointer-events:none}.df{word-break:break-word}.dg{word-wrap:break-word}.dh:after{display:block}.di:after{content:""}.dj:after{clear:both}.dk{max-width:680px}.dl{line-height:1.23}.dm{letter-spacing:0}.dn{font-style:normal}.do{font-family:fell, Georgia, Cambria, "Times New Roman", Times, serif}.ej{margin-bottom:-0.27em}.ek{color:rgba(41, 41, 41, 1)}.el{margin-top:32px}.em{justify-content:space-between}.eq{border-radius:50%}.er{height:48px}.es{width:48px}.et{margin-left:12px}.eu{font-size:14px}.ev{margin-bottom:2px}.ex{max-height:20px}.ey{text-overflow:ellipsis}.ez{display:-webkit-box}.fa{-webkit-line-clamp:1}.fb{-webkit-box-orient:vertical}.fe{margin-left:8px}.ff{color:rgba(255, 255, 255, 1)}.fg{padding:0px 8px 1px}.fh{fill:rgba(255, 255, 255, 1)}.fi{background:rgba(26, 137, 23, 1)}.fj{border-color:rgba(26, 137, 23, 1)}.fm:disabled{cursor:inherit}.fn:disabled{opacity:0.3}.fo:disabled:hover{background:rgba(26, 137, 23, 1)}.fp:disabled:hover{border-color:rgba(26, 137, 23, 1)}.fq{border-radius:4px}.fr{border-width:1px}.fs{border-style:solid}.ft{display:inline-block}.fu{text-decoration:none}.fv{align-items:flex-end}.gd{padding-right:6px}.ge{fill:rgba(117, 117, 117, 1)}.gf{margin-right:8px}.gg{margin-right:-6px}.gh{line-height:1.58}.gi{letter-spacing:-0.004em}.gj{font-family:charter, Georgia, Cambria, "Times New Roman", Times, serif}.he{margin-bottom:-0.46em}.hf{text-decoration:underline}.hg{list-style-type:decimal}.hh{margin-left:30px}.hi{padding-left:0px}.ho{line-height:1.12}.hp{letter-spacing:-0.022em}.hq{font-weight:500}.ij{margin-bottom:-0.28em}.ip{line-height:1.18}.jf{margin-bottom:-0.31em}.jg{font-weight:700}.jh{list-style-type:disc}.jn{padding:20px}.jo{background:rgba(242, 242, 242, 1)}.jp{font-family:Menlo, Monaco, "Courier New", Courier, monospace}.jq{font-size:16px}.jr{margin-top:-0.09em}.js{margin-bottom:-0.09em}.jt{white-space:pre-wrap}.jz{font-style:italic}.ka{opacity:0}.kb{will-change:opacity}.kc{position:fixed}.kd{width:188px}.ke{left:50%}.kf{transform:translateX(406px)}.kg{top:calc(65px + 54px + 14px)}.kj{top:159px}.kl{width:131px}.km{flex-direction:column}.kn{padding-bottom:28px}.ko{border-bottom:1px solid rgba(230, 230, 230, 1)}.kp{padding-bottom:20px}.kq{padding-top:2px}.kr{max-height:120px}.ks{-webkit-line-clamp:6}.kt{padding:7px 16px 9px}.ku{flex-direction:row}.kv{padding-top:28px}.kw{margin-bottom:19px}.kx{margin-left:-3px}.ky{position:relative}.le{outline:0}.lf{border:0}.lg{user-select:none}.lh{cursor:pointer}.li> svg{pointer-events:none}.lk{-webkit-user-select:none}.lu button{text-align:left}.lv{opacity:0.4}.lw{cursor:not-allowed}.lx{padding-right:9px}.mg{margin-top:40px}.mh{clear:both}.mi{flex-wrap:wrap}.mj{margin-top:25px}.mk{margin-bottom:8px}.ml{line-height:22px}.mm{border-radius:3px}.mn{padding:5px 10px}.mo{max-width:155px}.ms{top:1px}.ng{margin-left:-1px}.nh{margin-left:-4px}.np{padding-right:8px}.nq{padding-top:32px}.nr{margin-bottom:25px}.nt{margin-bottom:32px}.nu{min-height:80px}.nz{width:80px}.oa{padding-left:102px}.oc{line-height:18px}.od{letter-spacing:0.077em}.oe{margin-bottom:6px}.of{font-size:22px}.og{line-height:28px}.oh{padding:4px 12px 6px}.oi{max-width:555px}.oj{max-width:450px}.ok{line-height:24px}.ol{display:none}.on{max-width:550px}.oo{padding-top:24px}.op{margin-top:5px}.oq{height:40px}.or{width:40px}.os{font-size:12px}.ot{line-height:16px}.ou{letter-spacing:0.083em}.ov{padding-top:8px}.ow{background:rgba(255, 255, 255, 1)}.ox{margin-bottom:40px}.oy{margin-top:24px}.oz{padding-bottom:16px}.pa{margin-bottom:24px}.qm{flex-grow:0}.qn{padding-bottom:24px}.qo{max-width:500px}.qp{height:100%}.qt{padding-bottom:8px}.rg{transition:opacity 100ms 400ms}.rh{will-change:transform}.ri{transform:translateZ(0)}.rj{margin:auto}.rk{background-color:rgba(242, 242, 242, 1)}.rl{padding-bottom:100%}.rm{height:0}.rn{filter:blur(20px)}.ro{transform:scale(1.1)}.rp{visibility:visible}.sa{padding:60px 0}.sb{background-color:rgba(0, 0, 0, 0.9)}.sd{padding-bottom:48px}.se{border-bottom:1px solid rgba(255, 255, 255, 0.54)}.sf{margin:0 -12px}.sg{margin:0 12px}.sh{flex:1 1 0}.sk:disabled{color:rgba(255, 255, 255, 0.7)}.sl:disabled{fill:rgba(255, 255, 255, 0.7)}.sm{font-size:20px}.sn{color:rgba(255, 255, 255, 0.98)}.so{color:rgba(255, 255, 255, 0.7)}.sp{height:22px}.sq{width:200px}.sw{margin-right:16px}.bb:hover{cursor:pointer}.bc:hover{color:rgba(15, 115, 12, 1)}.bd:hover{fill:rgba(15, 115, 12, 1)}.cm:hover{color:rgba(25, 25, 25, 1)}.cn:hover{fill:rgba(25, 25, 25, 1)}.fd:hover{text-decoration:underline}.fk:hover{background:rgba(15, 115, 12, 1)}.fl:hover{border-color:rgba(15, 115, 12, 1)}.lm:hover{fill:rgba(117, 117, 117, 1)}.si:hover{color:rgba(255, 255, 255, 0.99)}.sj:hover{fill:rgba(255, 255, 255, 0.99)}.ll:focus{fill:rgba(117, 117, 117, 1)}.lj:active{border-style:none}</style><style type="text/css" data-fela-rehydration="516" data-fela-type="RULE" media="all and (min-width: 1080px)">.d{display:none}.ag{margin:0 64px}.ef{font-size:48px}.eg{margin-top:0.55em}.eh{line-height:60px}.ei{letter-spacing:-0.011em}.gc{margin-left:30px}.ha{font-size:21px}.hb{margin-top:2em}.hc{line-height:32px}.hd{letter-spacing:-0.003em}.hn{margin-top:1.05em}.if{font-size:30px}.ig{margin-top:1.95em}.ih{line-height:36px}.ii{letter-spacing:0}.io{margin-top:0.86em}.jc{font-size:22px}.jd{margin-top:1.72em}.je{line-height:28px}.jm{margin-top:56px}.jy{margin-top:1.91em}.ld{margin-right:5px}.lt{margin-top:5px}.mf{padding-left:6px}.mu{display:inline-block}.mz{margin-left:7px}.na{margin-top:8px}.nf{width:25px}.nn{padding-left:7px}.no{top:3px}.pp{width:calc(100% + 32px)}.pq{margin-left:-16px}.pr{margin-right:-16px}.qi{padding-left:16px}.qj{padding-right:16px}.qk{flex-basis:25%}.ql{max-width:25%}.rc{font-size:16px}.rd{line-height:20px}.ry{min-width:70px}.rz{min-height:70px}</style><style type="text/css" data-fela-rehydration="516" data-fela-type="RULE" media="all and (max-width: 1079.98px)">.e{display:none}.gb{margin-left:30px}.lc{margin-right:5px}.ls{margin-top:5px}.me{padding-left:6px}.mt{display:inline-block}.mx{margin-left:7px}.my{margin-top:8px}.ne{width:25px}.nl{padding-left:7px}.nm{top:3px}</style><style type="text/css" data-fela-rehydration="516" data-fela-type="RULE" media="all and (max-width: 903.98px)">.f{display:none}.ga{margin-left:30px}.lb{margin-right:5px}.lr{margin-top:5px}.mc{padding-left:6px}.md{top:3px}.mr{display:inline-block}.mv{margin-left:7px}.mw{margin-top:8px}.nd{width:15px}.nk{padding-left:3px}.qs{margin-right:16px}</style><style type="text/css" data-fela-rehydration="516" data-fela-type="RULE" media="all and (max-width: 727.98px)">.g{display:none}.al{height:56px}.am{display:flex}.bi{display:block}.ct{margin-bottom:0px}.cu{height:110px}.eo{margin-top:32px}.ep{flex-direction:column-reverse}.fy{margin-bottom:30px}.fz{margin-left:0px}.la{margin-left:8px}.lp{margin-top:2px}.lq{margin-right:8px}.ma{padding-left:6px}.mb{top:3px}.mq{display:inline-block}.nc{width:15px}.nj{padding-left:3px}.ns{padding-top:0}.nv{margin-bottom:24px}.nw{align-items:center}.nx{width:102px}.ny{position:relative}.ob{padding-left:0}.om{margin-top:24px}.pb{padding-bottom:12px}.pc{margin-top:16px}.qr{margin-right:16px}.re{margin-left:16px}.rf{margin-right:0px}.sc{padding:32px 0}.sr{width:140px}.ss{margin-bottom:16px}.st{margin-top:30px}.su{width:100%}.sv{flex-direction:row}</style><style type="text/css" data-fela-rehydration="516" data-fela-type="RULE" media="all and (max-width: 551.98px)">.h{display:none}.ab{margin:0 24px}.dp{font-size:34px}.dq{margin-top:0.56em}.dr{line-height:42px}.ds{letter-spacing:-0.016em}.en{margin-top:32px}.ew{margin-bottom:0px}.fw{margin-bottom:30px}.fx{margin-left:0px}.gk{font-size:18px}.gl{margin-top:1.56em}.gm{line-height:28px}.gn{letter-spacing:-0.003em}.hj{margin-top:1.34em}.hr{font-size:22px}.hs{margin-top:1.2em}.ht{letter-spacing:0}.ik{margin-top:0.67em}.iq{font-size:20px}.ir{margin-top:1.23em}.is{line-height:24px}.ji{margin-top:40px}.ju{margin-top:1.41em}.kz{margin-left:8px}.ln{margin-top:2px}.lo{margin-right:8px}.ly{padding-left:6px}.lz{top:3px}.mp{display:inline-block}.nb{width:15px}.ni{padding-left:3px}.pd{width:calc(100% + 24px)}.pe{margin-left:-12px}.pf{margin-right:-12px}.ps{padding-left:12px}.pt{padding-right:12px}.pu{flex-basis:100%}.pv{max-width:100%}.qq{margin-right:16px}.qu{font-size:16px}.qv{line-height:20px}.rq{min-width:48px}.rr{min-height:48px}</style><style type="text/css" data-fela-rehydration="516" data-fela-type="RULE" media="all and (min-width: 904px) and (max-width: 1079.98px)">.i{display:none}.af{margin:0 64px}.eb{font-size:48px}.ec{margin-top:0.55em}.ed{line-height:60px}.ee{letter-spacing:-0.011em}.gw{font-size:21px}.gx{margin-top:2em}.gy{line-height:32px}.gz{letter-spacing:-0.003em}.hm{margin-top:1.05em}.ib{font-size:30px}.ic{margin-top:1.95em}.id{line-height:36px}.ie{letter-spacing:0}.in{margin-top:0.86em}.iz{font-size:22px}.ja{margin-top:1.72em}.jb{line-height:28px}.jl{margin-top:56px}.jx{margin-top:1.91em}.pm{width:calc(100% + 32px)}.pn{margin-left:-16px}.po{margin-right:-16px}.qe{padding-left:16px}.qf{padding-right:16px}.qg{flex-basis:25%}.qh{max-width:25%}.ra{font-size:16px}.rb{line-height:20px}.rw{min-width:70px}.rx{min-height:70px}</style><style type="text/css" data-fela-rehydration="516" data-fela-type="RULE" media="all and (min-width: 728px) and (max-width: 903.98px)">.j{display:none}.ae{margin:0 48px}.dx{font-size:48px}.dy{margin-top:0.55em}.dz{line-height:60px}.ea{letter-spacing:-0.011em}.gs{font-size:21px}.gt{margin-top:2em}.gu{line-height:32px}.gv{letter-spacing:-0.003em}.hl{margin-top:1.05em}.hx{font-size:30px}.hy{margin-top:1.95em}.hz{line-height:36px}.ia{letter-spacing:0}.im{margin-top:0.86em}.iw{font-size:22px}.ix{margin-top:1.72em}.iy{line-height:28px}.jk{margin-top:56px}.jw{margin-top:1.91em}.pj{width:calc(100% + 28px)}.pk{margin-left:-14px}.pl{margin-right:-14px}.qa{padding-left:14px}.qb{padding-right:14px}.qc{flex-basis:50%}.qd{max-width:50%}.qy{font-size:16px}.qz{line-height:20px}.ru{min-width:48px}.rv{min-height:48px}</style><style type="text/css" data-fela-rehydration="516" data-fela-type="RULE" media="all and (min-width: 552px) and (max-width: 727.98px)">.k{display:none}.ac{margin:0 24px}.dt{font-size:34px}.du{margin-top:0.56em}.dv{line-height:42px}.dw{letter-spacing:-0.016em}.go{font-size:18px}.gp{margin-top:1.56em}.gq{line-height:28px}.gr{letter-spacing:-0.003em}.hk{margin-top:1.34em}.hu{font-size:22px}.hv{margin-top:1.2em}.hw{letter-spacing:0}.il{margin-top:0.67em}.it{font-size:20px}.iu{margin-top:1.23em}.iv{line-height:24px}.jj{margin-top:40px}.jv{margin-top:1.41em}.pg{width:calc(100% + 24px)}.ph{margin-left:-12px}.pi{margin-right:-12px}.pw{padding-left:12px}.px{padding-right:12px}.py{flex-basis:100%}.pz{max-width:100%}.qw{font-size:16px}.qx{line-height:20px}.rs{min-width:48px}.rt{min-height:48px}</style><style type="text/css" data-fela-rehydration="516" data-fela-type="RULE" media="print">.z{display:none}</style><style type="text/css" data-fela-rehydration="516" data-fela-type="RULE" media="(orientation: landscape) and (max-width: 903.98px)">.fc{max-height:none}</style><style type="text/css" data-fela-rehydration="516" data-fela-type="RULE" media="(prefers-reduced-motion: no-preference)">.kh{transition:opacity 200ms}</style><style type="text/css" data-fela-rehydration="516" data-fela-type="RULE" media="all and (max-width: 1230px)">.ki{display:none}</style><style type="text/css" data-fela-rehydration="516" data-fela-type="RULE" media="all and (max-width: 1198px)">.kk{display:none}</style></head><body><div id="root"><div class="a b c"><div class="d e f g h i j k"></div><script>document.domain = document.domain;</script><div><script>if (window.self !== window.top) window.location = "about:blank"</script></div><script>window.PARSELY = window.PARSELY || {autotrack: false}</script><div class="s"><nav class="s t u v w c x y z"><div><div class="s c"><div class="n p"><div class="ab ac ae af ag ah ai aj"><div class="ak n o al am"><div class="n o an x"><a href="https://medium.com/?source=post_page-----1cf5a71e5a5c--------------------------------" rel="noopener"><svg viewBox="0 0 1043.63 592.71" class="q ao"><g data-name="Layer 2"><g data-name="Layer 1"><path d="M588.67 296.36c0 163.67-131.78 296.35-294.33 296.35S0 460 0 296.36 131.78 0 294.34 0s294.33 132.69 294.33 296.36M911.56 296.36c0 154.06-65.89 279-147.17 279s-147.17-124.94-147.17-279 65.88-279 147.16-279 147.17 124.9 147.17 279M1043.63 296.36c0 138-23.17 249.94-51.76 249.94s-51.75-111.91-51.75-249.94 23.17-249.94 51.75-249.94 51.76 111.9 51.76 249.94"></path></g></g></svg></a></div><div class="s ap x"><div class="n o"><div class="n o g"><div class="aq" id="lo-post-page-navbar-sign-in-link"><div class="ar s"><span><a href="https://medium.com/m/signin?operation=login&amp;redirect=https%3A%2F%2Finstagram-engineering.com%2Fsharding-ids-at-instagram-1cf5a71e5a5c&amp;source=post_page-----1cf5a71e5a5c---------------------nav_reg-----------" class="as at au av aw ax ay az ba bb bc bd be bf bg" rel="noopener">Sign in</a></span></div></div></div></div></div></div></div></div></div><div class="bh s c bi"><div class="n p"><div class="ab ac ae af ag ah ai aj"><div class="bj bk n o"><div class="bl s ap"><a href="https://instagram-engineering.com/?source=post_page-----1cf5a71e5a5c--------------------------------" rel="noopener"><div class="bm bn s"><img alt="Instagram Engineering" class="" src="https://miro.medium.com/max/72/1*CPgwLHR6jno_tOmF0--7eg.jpeg" width="36" height="36"/></div></a></div><div class="bo s bp"><ul class="bq ba br bs bt n bu g bv bw bx"><li class="n o by bz ca cb"><span class="ce b cf cg ch ci cj"><a href="https://instagram-engineering.com/tagged/machine-learning?source=post_page-----1cf5a71e5a5c--------------------------------" class="ck cl au av aw ax ay az ba bb cm cn be co cp" rel="noopener">Machine Learning</a></span></li><li class="n o by bz ca cb"><span class="ce b cf cg ch ci cj"><a href="https://instagram-engineering.com/tagged/android?source=post_page-----1cf5a71e5a5c--------------------------------" class="ck cl au av aw ax ay az ba bb cm cn be co cp" rel="noopener">Android</a></span></li><li class="n o by bz ca cb"><span class="ce b cf cg ch ci cj"><a href="https://instagram-engineering.com/tagged/ios?source=post_page-----1cf5a71e5a5c--------------------------------" class="ck cl au av aw ax ay az ba bb cm cn be co cp" rel="noopener">iOS</a></span></li><li class="n o by bz ca cb"><span class="ce b cf cg ch ci cj"><a href="https://instagram-engineering.com/tagged/infrastructure?source=post_page-----1cf5a71e5a5c--------------------------------" class="ck cl au av aw ax ay az ba bb cm cn be co cp" rel="noopener">Infrastructure</a></span></li><li class="n o by bz ca cb"><span class="ce b cf cg ch ci cj"><a href="https://instagram-engineering.com/tagged/data?source=post_page-----1cf5a71e5a5c--------------------------------" class="ck cl au av aw ax ay az ba bb cm cn be co cp" rel="noopener">Data</a></span></li><li class="n o by bz ca cb"><span class="ce b cf cg ch ci cj"><a href="https://instagram-engineering.com/tagged/open-source?source=post_page-----1cf5a71e5a5c--------------------------------" class="ck cl au av aw ax ay az ba bb cm cn be co cp" rel="noopener">Open Source</a></span></li><li class="n o by bz ca cb"><span class="ce b cf cg ch ci cj"><a href="https://instagram-engineering.com/tagged/team?source=post_page-----1cf5a71e5a5c--------------------------------" class="ck cl au av aw ax ay az ba bb cm cn be co cp" rel="noopener">Team</a></span></li><span class="by cc cd"></span><li class="n o by bz ca cb"><span class="ce b cf cg ch ci cj"><a href="https://engineering.instagram.com/latest?source=post_page-----1cf5a71e5a5c--------------------------------" class="ck cl au av aw ax ay az ba bb cm cn be co cp" rel="noopener">View All Posts</a></span></li></ul></div></div></div></div></div></div></nav><div class="cq cr cs s ct cu"></div><article><section class="cv cw cx cy aj cz da s"></section><span class="s"></span><div><div class="t v db dc dd de"></div><section class="df dg dh di dj"><div class="n p"><div class="ab ac ae af ag dk ai aj"><div class=""><h1 id="e3d5" class="dl dm dn do b dp dq dr ds dt du dv dw dx dy dz ea eb ec ed ee ef eg eh ei ej ek">Sharding &amp; IDs at Instagram</h1><div class="el"><div class="n em en eo ep"><div class="o n"><div><a href="https://medium.com/@InstagramEng?source=post_page-----1cf5a71e5a5c--------------------------------" rel="noopener"><img alt="Instagram Engineering" class="s eq er es" src="https://miro.medium.com/fit/c/96/96/1*8x_1IP3b75o5u9M4LgFBig.jpeg" width="48" height="48"/></a></div><div class="et aj s"><div class="n"><div style="flex:1"><span class="ce b eu cg ek"><div class="ev n o ew"><span class="ce b eu cg bk ex ey ez fa fb fc ek"><a href="https://medium.com/@InstagramEng?source=post_page-----1cf5a71e5a5c--------------------------------" class="ck cl au av aw ax ay az ba bb fd be co cp" rel="noopener">Instagram Engineering</a></span><div class="fe s ap h"><span><a href="https://medium.com/m/signin?actionUrl=%2F_%2Fsubscribe%2Fuser%2Fa4c6efa67fe0&amp;operation=register&amp;redirect=https%3A%2F%2Finstagram-engineering.com%2Fsharding-ids-at-instagram-1cf5a71e5a5c&amp;source=post_page-a4c6efa67fe0----1cf5a71e5a5c---------------------follow_byline-----------" class="ce b cf cg ff fg fh fi fj fk fl bb fm fn fo fp fq fr fs da ft fu" rel="noopener">Follow</a></span></div></div></span></div></div><span class="ce b eu cg ch"><span class="ce b eu cg bk ex ey ez fa fb fc ch"><div><a class="ck cl au av aw ax ay az ba bb fd be co cp" rel="noopener" href="/sharding-ids-at-instagram-1cf5a71e5a5c?source=post_page-----1cf5a71e5a5c--------------------------------">Dec 30, 2012</a> <!-- -->·<!-- --> <!-- -->5<!-- --> min read</div></span></span></div></div><div class="n fv fw fx fy fz ga gb gc z"><div class="n o"><div class="gd s ap"><button class="ck cl au av aw ax ay az ba bb cm cn be co cp" aria-label="Share on twitter"><svg width="29" height="29" class="ge"><path d="M22.05 7.54a4.47 4.47 0 0 0-3.3-1.46 4.53 4.53 0 0 0-4.53 4.53c0 .35.04.7.08 1.05A12.9 12.9 0 0 1 5 6.89a5.1 5.1 0 0 0-.65 2.26c.03 1.6.83 2.99 2.02 3.79a4.3 4.3 0 0 1-2.02-.57v.08a4.55 4.55 0 0 0 3.63 4.44c-.4.08-.8.13-1.21.16l-.81-.08a4.54 4.54 0 0 0 4.2 3.15 9.56 9.56 0 0 1-5.66 1.94l-1.05-.08c2 1.27 4.38 2.02 6.94 2.02 8.3 0 12.86-6.9 12.84-12.85.02-.24 0-.43 0-.65a8.68 8.68 0 0 0 2.26-2.34c-.82.38-1.7.62-2.6.72a4.37 4.37 0 0 0 1.95-2.51c-.84.53-1.81.9-2.83 1.13z"></path></svg></button></div><div class="gd s ap"><button class="ck cl au av aw ax ay az ba bb cm cn be co cp" aria-label="Share on linkedin"><svg width="29" height="29" viewBox="0 0 29 29" fill="none" class="ge"><path d="M5 6.36C5 5.61 5.63 5 6.4 5h16.2c.77 0 1.4.61 1.4 1.36v16.28c0 .75-.63 1.36-1.4 1.36H6.4c-.77 0-1.4-.6-1.4-1.36V6.36z"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M10.76 20.9v-8.57H7.89v8.58h2.87zm-1.44-9.75c1 0 1.63-.65 1.63-1.48-.02-.84-.62-1.48-1.6-1.48-.99 0-1.63.64-1.63 1.48 0 .83.62 1.48 1.59 1.48h.01zM12.35 20.9h2.87v-4.79c0-.25.02-.5.1-.7.2-.5.67-1.04 1.46-1.04 1.04 0 1.46.8 1.46 1.95v4.59h2.87v-4.92c0-2.64-1.42-3.87-3.3-3.87-1.55 0-2.23.86-2.61 1.45h.02v-1.24h-2.87c.04.8 0 8.58 0 8.58z" fill="#fff"></path></svg></button></div><div class="gd s ap"><button class="ck cl au av aw ax ay az ba bb cm cn be co cp" aria-label="Share on facebook"><svg width="29" height="29" class="ge"><path d="M23.2 5H5.8a.8.8 0 0 0-.8.8V23.2c0 .44.35.8.8.8h9.3v-7.13h-2.38V13.9h2.38v-2.38c0-2.45 1.55-3.66 3.74-3.66 1.05 0 1.95.08 2.2.11v2.57h-1.5c-1.2 0-1.48.57-1.48 1.4v1.96h2.97l-.6 2.97h-2.37l.05 7.12h5.1a.8.8 0 0 0 .79-.8V5.8a.8.8 0 0 0-.8-.79"></path></svg></button></div><div class="gf s"><div class="ge"><span><a href="https://medium.com/m/signin?actionUrl=%2F_%2Fbookmark%2Fp%2F1cf5a71e5a5c&amp;operation=register&amp;redirect=https%3A%2F%2Finstagram-engineering.com%2Fsharding-ids-at-instagram-1cf5a71e5a5c&amp;source=post_actions_header--------------------------bookmark_preview-----------" class="ck cl au av aw ax ay az ba bb cm cn be co cp" rel="noopener"><svg width="25" height="25" viewBox="0 0 25 25"><path d="M19 6a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v14.66h.01c.01.1.05.2.12.28a.5.5 0 0 0 .7.03l5.67-4.12 5.66 4.13a.5.5 0 0 0 .71-.03.5.5 0 0 0 .12-.29H19V6zm-6.84 9.97L7 19.64V6a1 1 0 0 1 1-1h9a1 1 0 0 1 1 1v13.64l-5.16-3.67a.49.49 0 0 0-.68 0z" fill-rule="evenodd"></path></svg></a></span></div></div><div class="gg s an"></div></div></div></div></div></div><p id="da79" class="gh gi dn gj b gk gl gm gn go gp gq gr gs gt gu gv gw gx gy gz ha hb hc hd he df ek">With more than 25 photos and 90 likes every second, we store a lot of data here at Instagram. To make sure all of our important data fits into memory and is available quickly for our users, we’ve begun to <a href="http://www.facebook.com/l.php?u=http%3A%2F%2Fen.wikipedia.org%2Fwiki%2FShard_%28database%29&amp;h=lAQHFITrt&amp;s=1" class="ck hf" rel="noopener">shard</a> our data — in other words, place the data in many smaller buckets, each holding a part of the data.</p><p id="bfba" class="gh gi dn gj b gk gl gm gn go gp gq gr gs gt gu gv gw gx gy gz ha hb hc hd he df ek">Our application servers run <a href="http://www.facebook.com/l.php?u=http%3A%2F%2Fdjangoproject.com%2F&amp;h=sAQHcqWJT&amp;s=1" class="ck hf" rel="noopener">Django</a> with <a href="http://www.facebook.com/l.php?u=http%3A%2F%2Fpostgresql.org%2F&amp;h=iAQGuql57&amp;s=1" class="ck hf" rel="noopener">PostgreSQL</a> as our back-end database. Our first question after deciding to shard out our data was whether PostgreSQL should remain our primary data-store, or whether we should switch to something else. We evaluated a few different NoSQL solutions, but ultimately decided that the solution that best suited our needs would be to shard our data across a set of PostgreSQL servers.</p><p id="6dec" class="gh gi dn gj b gk gl gm gn go gp gq gr gs gt gu gv gw gx gy gz ha hb hc hd he df ek">Before writing data into this set of servers, however, we had to solve the issue of how to assign unique identifiers to each piece of data in the database (for example, each photo posted in our system). The typical solution that works for a single database — just using a database’s natural auto-incrementing primary key feature — no longer works when data is being inserted into many databases at the same time. The rest of this blog post addresses how we tackled this issue.</p><p id="33d5" class="gh gi dn gj b gk gl gm gn go gp gq gr gs gt gu gv gw gx gy gz ha hb hc hd he df ek">Before starting out, we listed out what features were essential in our system:</p><ol class=""><li id="1012" class="gh gi dn gj b gk gl gm gn go gp gq gr gs gt gu gv gw gx gy gz ha hb hc hd he hg hh hi ek">Generated IDs should be sortable by time (so a list of photo IDs, for example, could be sorted without fetching more information about the photos)</li><li id="4d7d" class="gh gi dn gj b gk hj gm gn go hk gq gr gs hl gu gv gw hm gy gz ha hn hc hd he hg hh hi ek">IDs should ideally be 64 bits (for smaller indexes, and better storage in systems like Redis)</li><li id="be99" class="gh gi dn gj b gk hj gm gn go hk gq gr gs hl gu gv gw hm gy gz ha hn hc hd he hg hh hi ek">The system should introduce as few new ‘moving parts’ as possible — a large part of how we’ve been able to scale Instagram with very few engineers is by choosing simple, easy-to-understand solutions that we trust.</li></ol><h1 id="70ef" class="ho hp dn ce hq hr hs gm ht hu hv gq hw hx hy hz ia ib ic id ie if ig ih ii ij ek">Existing solutions</h1><p id="b933" class="gh gi dn gj b gk ik gm gn go il gq gr gs im gu gv gw in gy gz ha io hc hd he df ek">Many existing solutions to the ID generation problem exist; here are a few we considered:</p><h2 id="60a6" class="ip hp dn ce hq iq ir is ht it iu iv hw iw ix iy ia iz ja jb ie jc jd je ii jf ek">Generate IDs in web application</h2><p id="c629" class="gh gi dn gj b gk ik gm gn go il gq gr gs im gu gv gw in gy gz ha io hc hd he df ek">This approach leaves ID generation entirely up to your application, and not up to the database at all. For example, <a href="http://www.facebook.com/l.php?u=http%3A%2F%2Fwww.mongodb.org%2Fdisplay%2FDOCS%2FObject%2BIDs&amp;h=fAQFgEvBI&amp;s=1" class="ck hf" rel="noopener">MongoDB’s ObjectId</a>, which is 12 bytes long and encodes the timestamp as the first component. Another popular approach is to use <a href="http://www.facebook.com/l.php?u=http%3A%2F%2Fen.wikipedia.org%2Fwiki%2FUniversally_unique_identifier&amp;h=MAQFZAMfT&amp;s=1" class="ck hf" rel="noopener">UUIDs</a>.</p><p id="cac7" class="gh gi dn gj b gk gl gm gn go gp gq gr gs gt gu gv gw gx gy gz ha hb hc hd he df ek"><strong class="gj jg">Pros:</strong></p><ol class=""><li id="825c" class="gh gi dn gj b gk gl gm gn go gp gq gr gs gt gu gv gw gx gy gz ha hb hc hd he hg hh hi ek">Each application thread generates IDs independently, minimizing points of failure and contention for ID generation</li><li id="8e47" class="gh gi dn gj b gk hj gm gn go hk gq gr gs hl gu gv gw hm gy gz ha hn hc hd he hg hh hi ek">If you use a timestamp as the first component of the ID, the IDs remain time-sortable</li></ol><p id="78ab" class="gh gi dn gj b gk gl gm gn go gp gq gr gs gt gu gv gw gx gy gz ha hb hc hd he df ek"><strong class="gj jg">Cons:</strong></p><ol class=""><li id="3488" class="gh gi dn gj b gk gl gm gn go gp gq gr gs gt gu gv gw gx gy gz ha hb hc hd he hg hh hi ek">Generally requires more storage space (96 bits or higher) to make reasonable uniqueness guarantees</li><li id="132d" class="gh gi dn gj b gk hj gm gn go hk gq gr gs hl gu gv gw hm gy gz ha hn hc hd he hg hh hi ek">Some UUID types are completely random and have no natural sort</li></ol><h2 id="1dfc" class="ip hp dn ce hq iq ir is ht it iu iv hw iw ix iy ia iz ja jb ie jc jd je ii jf ek">Generate IDs through dedicated service</h2><p id="18ec" class="gh gi dn gj b gk ik gm gn go il gq gr gs im gu gv gw in gy gz ha io hc hd he df ek">Ex: Twitter’s <a href="http://www.facebook.com/l.php?u=http%3A%2F%2Fgithub.com%2Ftwitter%2Fsnowflake%2F&amp;h=9AQHsyMKM&amp;s=1" class="ck hf" rel="noopener">Snowflake</a>, a Thrift service that uses Apache ZooKeeper to coordinate nodes and then generates 64-bit unique IDs</p><p id="56bb" class="gh gi dn gj b gk gl gm gn go gp gq gr gs gt gu gv gw gx gy gz ha hb hc hd he df ek"><strong class="gj jg">Pros:</strong></p><ol class=""><li id="57bf" class="gh gi dn gj b gk gl gm gn go gp gq gr gs gt gu gv gw gx gy gz ha hb hc hd he hg hh hi ek">Snowflake IDs are 64-bits, half the size of a UUID</li><li id="da49" class="gh gi dn gj b gk hj gm gn go hk gq gr gs hl gu gv gw hm gy gz ha hn hc hd he hg hh hi ek">Can use time as first component and remain sortable</li><li id="1754" class="gh gi dn gj b gk hj gm gn go hk gq gr gs hl gu gv gw hm gy gz ha hn hc hd he hg hh hi ek">Distributed system that can survive nodes dying</li></ol><p id="6714" class="gh gi dn gj b gk gl gm gn go gp gq gr gs gt gu gv gw gx gy gz ha hb hc hd he df ek"><strong class="gj jg">Cons:</strong></p><ol class=""><li id="4ec6" class="gh gi dn gj b gk gl gm gn go gp gq gr gs gt gu gv gw gx gy gz ha hb hc hd he hg hh hi ek">Would introduce additional complexity and more ‘moving parts’ (ZooKeeper, Snowflake servers) into our architecture</li></ol><h2 id="360d" class="ip hp dn ce hq iq ir is ht it iu iv hw iw ix iy ia iz ja jb ie jc jd je ii jf ek">DB Ticket Servers</h2><p id="1ed8" class="gh gi dn gj b gk ik gm gn go il gq gr gs im gu gv gw in gy gz ha io hc hd he df ek">Uses the database’s auto-incrementing abilities to enforce uniqueness. <a href="http://www.facebook.com/l.php?u=http%3A%2F%2Fcode.flickr.com%2Fblog%2F2010%2F02%2F08%2Fticket-servers-distributed-unique-primary-keys-on-the-cheap%2F&amp;h=xAQEgbGg0&amp;s=1" class="ck hf" rel="noopener">Flickr uses this approach</a>, but with two ticket DBs (one on odd numbers, the other on even) to avoid a single point of failure.</p><p id="21fa" class="gh gi dn gj b gk gl gm gn go gp gq gr gs gt gu gv gw gx gy gz ha hb hc hd he df ek"><strong class="gj jg">Pros:</strong></p><ol class=""><li id="2efa" class="gh gi dn gj b gk gl gm gn go gp gq gr gs gt gu gv gw gx gy gz ha hb hc hd he hg hh hi ek">DBs are well understood and have pretty predictable scaling factors</li></ol><p id="1cfc" class="gh gi dn gj b gk gl gm gn go gp gq gr gs gt gu gv gw gx gy gz ha hb hc hd he df ek"><strong class="gj jg">Cons:</strong></p><ol class=""><li id="5459" class="gh gi dn gj b gk gl gm gn go gp gq gr gs gt gu gv gw gx gy gz ha hb hc hd he hg hh hi ek">Can eventually become a write bottleneck (though Flickr reports that, even at huge scale, it’s not an issue).</li><li id="f344" class="gh gi dn gj b gk hj gm gn go hk gq gr gs hl gu gv gw hm gy gz ha hn hc hd he hg hh hi ek">An additional couple of machines (or EC2 instances) to admin</li><li id="ad41" class="gh gi dn gj b gk hj gm gn go hk gq gr gs hl gu gv gw hm gy gz ha hn hc hd he hg hh hi ek">If using a single DB, becomes single point of failure. If using multiple DBs, can no longer guarantee that they are sortable over time.</li></ol><p id="1ed1" class="gh gi dn gj b gk gl gm gn go gp gq gr gs gt gu gv gw gx gy gz ha hb hc hd he df ek">Of all the approaches above, Twitter’s Snowflake came the closest, but the additional complexity required to run an ID service was a point against it. Instead, we took a conceptually similar approach, but brought it inside PostgreSQL.</p><h1 id="4c60" class="ho hp dn ce hq hr hs gm ht hu hv gq hw hx hy hz ia ib ic id ie if ig ih ii ij ek">Our solution</h1><p id="058c" class="gh gi dn gj b gk ik gm gn go il gq gr gs im gu gv gw in gy gz ha io hc hd he df ek">Our sharded system consists of several thousand ‘logical’ shards that are mapped in code to far fewer physical shards. Using this approach, we can start with just a few database servers, and eventually move to many more, simply by moving a set of logical shards from one database to another, without having to re-bucket any of our data. We used Postgres’ schemas feature to make this easy to script and administrate.</p><p id="a766" class="gh gi dn gj b gk gl gm gn go gp gq gr gs gt gu gv gw gx gy gz ha hb hc hd he df ek">Schemas (not to be confused with the SQL schema of an individual table) are a logical grouping feature in Postgres. Each Postgres DB can h2have several schemas, each of which can contain one or more tables. Table names must only be unique per-schema, not per-DB, and by default Postgres places everything in a schema named ‘public’.</p><p id="2f83" class="gh gi dn gj b gk gl gm gn go gp gq gr gs gt gu gv gw gx gy gz ha hb hc hd he df ek">Each ‘logical’ shard is a Postgres schema in our system, and each sharded table (for example, likes on our photos) exists inside each schema.</p><p id="722a" class="gh gi dn gj b gk gl gm gn go gp gq gr gs gt gu gv gw gx gy gz ha hb hc hd he df ek">We’ve delegated ID creation to each table inside each shard, by using PL/PGSQL, Postgres’ internal programming language, and Postgres’ existing auto-increment functionality.</p><p id="b78f" class="gh gi dn gj b gk gl gm gn go gp gq gr gs gt gu gv gw gx gy gz ha hb hc hd he df ek">Each of our IDs consists of:</p><ul class=""><li id="8172" class="gh gi dn gj b gk gl gm gn go gp gq gr gs gt gu gv gw gx gy gz ha hb hc hd he jh hh hi ek">41 bits for time in milliseconds (gives us 41 years of IDs with a custom epoch)</li><li id="c457" class="gh gi dn gj b gk hj gm gn go hk gq gr gs hl gu gv gw hm gy gz ha hn hc hd he jh hh hi ek">13 bits that represent the logical shard ID</li><li id="55d4" class="gh gi dn gj b gk hj gm gn go hk gq gr gs hl gu gv gw hm gy gz ha hn hc hd he jh hh hi ek">10 bits that represent an auto-incrementing sequence, modulus 1024. This means we can generate 1024 IDs, per shard, per millisecond</li></ul><p id="ddb7" class="gh gi dn gj b gk gl gm gn go gp gq gr gs gt gu gv gw gx gy gz ha hb hc hd he df ek">Let’s walk through an example: let’s say it’s September 9th, 2011, at 5:00pm and our ‘epoch’ begins on January 1st, 2011. There have been 1387263000 milliseconds since the beginning of our epoch, so to start our ID, we fill the left-most 41 bits with this value with a left-shift:</p><pre class="ji jj jk jl jm jn jo bt"><span id="9940" class="ek ip hp dn jp b jq jr js s jt">id = 1387263000 &lt;&lt;(64-41)</span></pre><p id="f8be" class="gh gi dn gj b gk gl gm gn go gp gq gr gs gt gu gv gw gx gy gz ha hb hc hd he df ek">Next, we take the shard ID for this particular piece of data we’re trying to insert. Let’s say we’re sharding by user ID, and there are 2000 logical shards; if our user ID is 31341, then the shard ID is 31341 % 2000 -&gt; 1341. We fill the next 13 bits with this value:</p><pre class="ji jj jk jl jm jn jo bt"><span id="d0ff" class="ek ip hp dn jp b jq jr js s jt">id |= 1341 &lt;&lt;(64-41-13)</span></pre><p id="983e" class="gh gi dn gj b gk gl gm gn go gp gq gr gs gt gu gv gw gx gy gz ha hb hc hd he df ek">Finally, we take whatever the next value of our auto-increment sequence (this sequence is unique to each table in each schema) and fill out the remaining bits. Let’s say we’d generated 5,000 IDs for this table already; our next value is 5,001, which we take and mod by 1024 (so it fits in 10 bits) and include it too:</p><pre class="ji jj jk jl jm jn jo bt"><span id="1364" class="ek ip hp dn jp b jq jr js s jt">id |= (5001 % 1024)</span></pre><p id="1ed9" class="gh gi dn gj b gk gl gm gn go gp gq gr gs gt gu gv gw gx gy gz ha hb hc hd he df ek">We now have our ID, which we can return to the application server using the RETURNING keyword as part of the INSERT.</p><p id="ff0d" class="gh gi dn gj b gk gl gm gn go gp gq gr gs gt gu gv gw gx gy gz ha hb hc hd he df ek">Here’s the PL/PGSQL that accomplishes all this (for an example schema insta5):</p><pre class="ji jj jk jl jm jn jo bt"><span id="fc17" class="ek ip hp dn jp b jq jr js s jt">CREATE OR REPLACE FUNCTION insta5.next_id(OUT result bigint) AS $$<br/>DECLARE<br/>    our_epoch bigint := 1314220021721;<br/>    seq_id bigint;<br/>    now_millis bigint;<br/>    shard_id int := 5;<br/>BEGIN<br/>    SELECT nextval(&#x27;insta5.table_id_seq&#x27;) %% 1024 INTO seq_id;</span><span id="9622" class="ek ip hp dn jp b jq ju jv jw jx jy js s jt">    SELECT FLOOR(EXTRACT(EPOCH FROM clock_timestamp()) * 1000) INTO now_millis;<br/>    result := (now_millis - our_epoch) &lt;&lt; 23;<br/>    result := result | (shard_id &lt;&lt;10);<br/>    result := result | (seq_id);<br/>END;<br/>    $$ LANGUAGE PLPGSQL;</span></pre><p id="c828" class="gh gi dn gj b gk gl gm gn go gp gq gr gs gt gu gv gw gx gy gz ha hb hc hd he df ek">And when creating the table, we do:</p><pre class="ji jj jk jl jm jn jo bt"><span id="f4da" class="ek ip hp dn jp b jq jr js s jt">CREATE TABLE insta5.our_table (<br/>    &quot;id&quot; bigint NOT NULL DEFAULT insta5.next_id(),<br/>    ...rest of table schema...<br/>  )</span></pre><p id="33af" class="gh gi dn gj b gk gl gm gn go gp gq gr gs gt gu gv gw gx gy gz ha hb hc hd he df ek">And that’s it! Primary keys that are unique across our application (and as a bonus, contain the shard ID in them for easier mapping). We’ve been rolling this approach into production and are happy with the results so far. Interested in helping us figure out these problems at scale? <a href="http://www.facebook.com/l.php?u=http%3A%2F%2Finstagram.com%2Fabout%2Fjobs%2F&amp;h=MAQFZAMfT&amp;s=1" class="ck hf" rel="noopener">We’re hiring!</a></p><p id="f3ef" class="gh gi dn gj b gk gl gm gn go gp gq gr gs gt gu gv gw gx gy gz ha hb hc hd he df ek"><em class="jz">Discuss this post on </em><a href="http://www.facebook.com/l.php?u=http%3A%2F%2Fnews.ycombinator.com%2Fitem%3Fid%3D3058327&amp;h=AAQGg9bLp&amp;s=1" class="ck hf" rel="noopener"><em class="jz">Hacker News</em></a><em class="jz">.</em></p></div></div></section></div></article><div class="ka de kc kb aj kj kh kk" data-test-id="post-sidebar"><div class="n p"><div class="ab ac ae af ag ah ai aj"><div class="kl n km"><div class="de"><div><div class="kn ko s"><a href="https://instagram-engineering.com/?source=post_sidebar--------------------------post_sidebar-----------" class="ck cl au av aw ax ay az ba bb cm cn be co cp" rel="noopener"><h2 class="ce hq jq cg dm ek df">Instagram Engineering</h2></a><div class="kp kq s"><h4 class="ce b eu cg bk kr ey ez ks fb fc ch">Stories from the people who build @Instagram</h4></div><div class="ft" aria-hidden="false"><span><a href="https://medium.com/m/signin?actionUrl=%2F_%2Fsubscribe%2Fcollection%2Finstagram-engineering%2F1cf5a71e5a5c&amp;operation=register&amp;redirect=https%3A%2F%2Finstagram-engineering.com%2Fsharding-ids-at-instagram-1cf5a71e5a5c&amp;source=post_sidebar--------------------------follow_sidebar-----------" class="ce b eu cg ff kt fh fi fj fk fl bb fm fn fo fp fq fr fs da ft fu" rel="noopener"><div class="n ku">Follow</div></a></span></div></div><div class="kv kw kx n"><div class="n o"><div class="s ky kz la lb lc ld"><span><a href="https://medium.com/m/signin?actionUrl=%2F_%2Fvote%2Finstagram-engineering%2F1cf5a71e5a5c&amp;operation=register&amp;redirect=https%3A%2F%2Finstagram-engineering.com%2Fsharding-ids-at-instagram-1cf5a71e5a5c&amp;source=post_sidebar-----1cf5a71e5a5c---------------------clap_sidebar-----------" class="ck cl au av aw ax ay az ba bb cm cn be co cp" rel="noopener"><div class="az le lf lg lh li lj lk r ll lm"><svg width="29" height="29" aria-label="clap"><g fill-rule="evenodd"><path d="M13.74 1l.76 2.97.76-2.97zM16.82 4.78l1.84-2.56-1.43-.47zM10.38 2.22l1.84 2.56-.41-3.03zM22.38 22.62a5.11 5.11 0 0 1-3.16 1.61l.49-.45c2.88-2.89 3.45-5.98 1.69-9.21l-1.1-1.94-.96-2.02c-.31-.67-.23-1.18.25-1.55a.84.84 0 0 1 .66-.16c.34.05.66.28.88.6l2.85 5.02c1.18 1.97 1.38 5.12-1.6 8.1M9.1 22.1l-5.02-5.02a1 1 0 0 1 .7-1.7 1 1 0 0 1 .72.3l2.6 2.6a.44.44 0 0 0 .63-.62L6.1 15.04l-1.75-1.75a1 1 0 1 1 1.41-1.41l4.15 4.15a.44.44 0 0 0 .63 0 .44.44 0 0 0 0-.62L6.4 11.26l-1.18-1.18a1 1 0 0 1 0-1.4 1.02 1.02 0 0 1 1.41 0l1.18 1.16L11.96 14a.44.44 0 0 0 .62 0 .44.44 0 0 0 0-.63L8.43 9.22a.99.99 0 0 1-.3-.7.99.99 0 0 1 .3-.7 1 1 0 0 1 1.41 0l7 6.98a.44.44 0 0 0 .7-.5l-1.35-2.85c-.31-.68-.23-1.19.25-1.56a.85.85 0 0 1 .66-.16c.34.06.66.28.88.6L20.63 15c1.57 2.88 1.07 5.54-1.55 8.16a5.62 5.62 0 0 1-5.06 1.65 9.35 9.35 0 0 1-4.93-2.72zM13 6.98l2.56 2.56c-.5.6-.56 1.41-.15 2.28l.26.56-4.25-4.25a.98.98 0 0 1-.12-.45 1 1 0 0 1 .29-.7 1.02 1.02 0 0 1 1.41 0zm8.89 2.06c-.38-.56-.9-.92-1.49-1.01a1.74 1.74 0 0 0-1.34.33c-.38.29-.61.65-.71 1.06a2.1 2.1 0 0 0-1.1-.56 1.78 1.78 0 0 0-.99.13l-2.64-2.64a1.88 1.88 0 0 0-2.65 0 1.86 1.86 0 0 0-.48.85 1.89 1.89 0 0 0-2.67-.01 1.87 1.87 0 0 0-.5.9c-.76-.75-2-.75-2.7-.04a1.88 1.88 0 0 0 0 2.66c-.3.12-.61.29-.87.55a1.88 1.88 0 0 0 0 2.66l.62.62a1.88 1.88 0 0 0-.9 3.16l5.01 5.02c1.6 1.6 3.52 2.64 5.4 2.96a7.16 7.16 0 0 0 1.18.1c1.03 0 2-.25 2.9-.7A5.9 5.9 0 0 0 23 23.24c3.34-3.34 3.08-6.93 1.74-9.17l-2.87-5.04z"></path></g></svg></div></a></span></div><div class="s ln lo lp lq lr ls lt"><div class="lu"><h4 class="ce b eu cg ch"><button class="ck cl au av aw ax ay az ba bb cm cn be co cp">3.8K<!-- --> </button></h4></div></div></div></div><div class="kw s"><button class="lh lf az"><div class="lx n o ku"><svg width="25" height="25" class="r" aria-label="responses"><path d="M19.07 21.12a6.33 6.33 0 0 1-3.53-1.1 7.8 7.8 0 0 1-.7-.52c-.77.21-1.57.32-2.38.32-4.67 0-8.46-3.5-8.46-7.8C4 7.7 7.79 4.2 12.46 4.2c4.66 0 8.46 3.5 8.46 7.8 0 2.06-.85 3.99-2.4 5.45a6.28 6.28 0 0 0 1.14 2.59c.15.21.17.48.06.7a.69.69 0 0 1-.62.38h-.03zm0-1v.5l.03-.5h-.03zm-3.92-1.64l.21.2a6.09 6.09 0 0 0 3.24 1.54 7.14 7.14 0 0 1-.83-1.84 5.15 5.15 0 0 1-.16-.75 2.4 2.4 0 0 1-.02-.29v-.23l.18-.15a6.6 6.6 0 0 0 2.3-4.96c0-3.82-3.4-6.93-7.6-6.93-4.19 0-7.6 3.11-7.6 6.93 0 3.83 3.41 6.94 7.6 6.94.83 0 1.64-.12 2.41-.35l.28-.08z" fill-rule="evenodd"></path></svg><div class="s ky ly lz ma mb mc md me mf"><h4 class="ce b eu cg ch">28<!-- --> </h4></div></div></button></div><div class="ge"><span><a href="https://medium.com/m/signin?actionUrl=%2F_%2Fbookmark%2Fp%2F1cf5a71e5a5c&amp;operation=register&amp;redirect=https%3A%2F%2Finstagram-engineering.com%2Fsharding-ids-at-instagram-1cf5a71e5a5c&amp;source=post_sidebar-----1cf5a71e5a5c---------------------bookmark_sidebar-----------" class="ck cl au av aw ax ay az ba bb cm cn be co cp" rel="noopener"><svg width="25" height="25" viewBox="0 0 25 25"><path d="M19 6a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v14.66h.01c.01.1.05.2.12.28a.5.5 0 0 0 .7.03l5.67-4.12 5.66 4.13a.5.5 0 0 0 .71-.03.5.5 0 0 0 .12-.29H19V6zm-6.84 9.97L7 19.64V6a1 1 0 0 1 1-1h9a1 1 0 0 1 1 1v13.64l-5.16-3.67a.49.49 0 0 0-.68 0z" fill-rule="evenodd"></path></svg></a></span></div></div></div></div></div></div></div><div class="ka de kb kc kd ke kf kg kh ki"></div><div><div class="mg mh n km p"><div class="n p"><div class="ab ac ae af ag dk ai aj"><div class="n mi"></div><div class="n o mi"></div><div class="mj s"><ul class="az ba"><li class="ft bq gf mk"><a href="/tagged/infra" class="ce b cf ml ch mm mn fu s jo">Infra</a></li><li class="ft bq gf mk"><a href="/tagged/open-source" class="ce b cf ml ch mm mn fu s jo">Open Source</a></li></ul></div><div class="mj n em z"><div class="n ku"><div class="mo s"><span class="s mp mq mr e d"><div class="n o"><div class="s ky kz la lb lc ld"><span><a href="https://medium.com/m/signin?actionUrl=%2F_%2Fvote%2Finstagram-engineering%2F1cf5a71e5a5c&amp;operation=register&amp;redirect=https%3A%2F%2Finstagram-engineering.com%2Fsharding-ids-at-instagram-1cf5a71e5a5c&amp;source=post_actions_footer-----1cf5a71e5a5c---------------------clap_footer-----------" class="ck cl au av aw ax ay az ba bb cm cn be co cp" rel="noopener"><div class="az le lf lg lh li lj lk r ll lm"><svg width="25" height="25" viewBox="0 0 25 25" aria-label="clap"><g fill-rule="evenodd"><path d="M11.74 0l.76 2.97.76-2.97zM14.81 3.78l1.84-2.56-1.42-.47zM8.38 1.22l1.84 2.56L9.8.75zM20.38 21.62a5.11 5.11 0 0 1-3.16 1.61l.49-.45c2.88-2.89 3.45-5.98 1.69-9.21l-1.1-1.94-.96-2.02c-.31-.67-.23-1.18.25-1.55a.84.84 0 0 1 .66-.16c.34.05.66.28.88.6l2.85 5.02c1.18 1.97 1.38 5.12-1.6 8.1M7.1 21.1l-5.02-5.02a1 1 0 0 1 .7-1.7 1 1 0 0 1 .72.3l2.6 2.6a.44.44 0 0 0 .63-.62L4.1 14.04l-1.75-1.75a1 1 0 1 1 1.41-1.41l4.15 4.15a.44.44 0 0 0 .63 0 .44.44 0 0 0 0-.62L4.4 10.26 3.22 9.08a1 1 0 0 1 0-1.4 1.02 1.02 0 0 1 1.41 0l1.18 1.16L9.96 13a.44.44 0 0 0 .62 0 .44.44 0 0 0 0-.63L6.43 8.22a.99.99 0 0 1-.3-.7.99.99 0 0 1 .3-.7 1 1 0 0 1 1.41 0l7 6.98a.44.44 0 0 0 .7-.5l-1.35-2.85c-.31-.68-.23-1.19.25-1.56a.85.85 0 0 1 .66-.16c.34.06.66.28.88.6L18.63 14c1.57 2.88 1.07 5.54-1.55 8.16a5.62 5.62 0 0 1-5.06 1.65 9.35 9.35 0 0 1-4.93-2.72zM11 5.98l2.56 2.56c-.5.6-.56 1.41-.15 2.28l.26.56-4.25-4.25a.98.98 0 0 1-.12-.45 1 1 0 0 1 .29-.7 1.02 1.02 0 0 1 1.41 0zm8.89 2.06c-.38-.56-.9-.92-1.49-1.01a1.74 1.74 0 0 0-1.34.33c-.38.29-.61.65-.71 1.06a2.1 2.1 0 0 0-1.1-.56 1.78 1.78 0 0 0-.99.13l-2.64-2.64a1.88 1.88 0 0 0-2.65 0 1.86 1.86 0 0 0-.48.85 1.89 1.89 0 0 0-2.67-.01 1.87 1.87 0 0 0-.5.9c-.76-.75-2-.75-2.7-.04a1.88 1.88 0 0 0 0 2.66c-.3.12-.61.29-.87.55a1.88 1.88 0 0 0 0 2.66l.62.62a1.88 1.88 0 0 0-.9 3.16l5.01 5.02c1.6 1.6 3.52 2.64 5.4 2.96a7.16 7.16 0 0 0 1.18.1c1.03 0 2-.25 2.9-.7A5.9 5.9 0 0 0 21 22.24c3.34-3.34 3.08-6.93 1.74-9.17l-2.87-5.04z"></path></g></svg></div></a></span></div><div class="s ln lo lp lq lr ls lt"><div class="ky ms lu"><h4 class="ce b eu cg ek"><button class="ck cl au av aw ax ay az ba bb cm cn be co cp">3.8K<span class="s h g f mt mu"> <!-- -->claps</span></button><span class="s h g f mt mu"></span></h4></div></div></div></span><span class="s h g f mt mu"><div class="n bu"><div class="s ky kz la"><span><a href="https://medium.com/m/signin?actionUrl=%2F_%2Fvote%2Finstagram-engineering%2F1cf5a71e5a5c&amp;operation=register&amp;redirect=https%3A%2F%2Finstagram-engineering.com%2Fsharding-ids-at-instagram-1cf5a71e5a5c&amp;source=post_actions_footer-----1cf5a71e5a5c---------------------clap_footer-----------" class="ck cl au av aw ax ay az ba bb cm cn be co cp" rel="noopener"><div class="az le lf lg lh li lj lk r ll lm"><svg width="33" height="33" viewBox="0 0 33 33" aria-label="clap"><path d="M28.86 17.34l-3.64-6.4c-.3-.43-.71-.73-1.16-.8a1.12 1.12 0 0 0-.9.21c-.62.5-.73 1.18-.32 2.06l1.22 2.6 1.4 2.45c2.23 4.09 1.51 8-2.15 11.66a9.6 9.6 0 0 1-.8.71 6.53 6.53 0 0 0 4.3-2.1c3.82-3.82 3.57-7.87 2.05-10.39zm-6.25 11.08c3.35-3.35 4-6.78 1.98-10.47L21.2 12c-.3-.43-.71-.72-1.16-.8a1.12 1.12 0 0 0-.9.22c-.62.49-.74 1.18-.32 2.06l1.72 3.63a.5.5 0 0 1-.81.57l-8.91-8.9a1.33 1.33 0 0 0-1.89 1.88l5.3 5.3a.5.5 0 0 1-.71.7l-5.3-5.3-1.49-1.49c-.5-.5-1.38-.5-1.88 0a1.34 1.34 0 0 0 0 1.89l1.49 1.5 5.3 5.28a.5.5 0 0 1-.36.86.5.5 0 0 1-.36-.15l-5.29-5.29a1.34 1.34 0 0 0-1.88 0 1.34 1.34 0 0 0 0 1.89l2.23 2.23L9.3 21.4a.5.5 0 0 1-.36.85.5.5 0 0 1-.35-.14l-3.32-3.33a1.33 1.33 0 0 0-1.89 0 1.32 1.32 0 0 0-.39.95c0 .35.14.69.4.94l6.39 6.4c3.53 3.53 8.86 5.3 12.82 1.35zM12.73 9.26l5.68 5.68-.49-1.04c-.52-1.1-.43-2.13.22-2.89l-3.3-3.3a1.34 1.34 0 0 0-1.88 0 1.33 1.33 0 0 0-.4.94c0 .22.07.42.17.61zm14.79 19.18a7.46 7.46 0 0 1-6.41 2.31 7.92 7.92 0 0 1-3.67.9c-3.05 0-6.12-1.63-8.36-3.88l-6.4-6.4A2.31 2.31 0 0 1 2 19.72a2.33 2.33 0 0 1 1.92-2.3l-.87-.87a2.34 2.34 0 0 1 0-3.3 2.33 2.33 0 0 1 1.24-.64l-.14-.14a2.34 2.34 0 0 1 0-3.3 2.39 2.39 0 0 1 3.3 0l.14.14a2.33 2.33 0 0 1 3.95-1.24l.09.09c.09-.42.29-.83.62-1.16a2.34 2.34 0 0 1 3.3 0l3.38 3.39a2.17 2.17 0 0 1 1.27-.17c.54.08 1.03.35 1.45.76.1-.55.41-1.03.9-1.42a2.12 2.12 0 0 1 1.67-.4 2.8 2.8 0 0 1 1.85 1.25l3.65 6.43c1.7 2.83 2.03 7.37-2.2 11.6zM13.22.48l-1.92.89 2.37 2.83-.45-3.72zm8.48.88L19.78.5l-.44 3.7 2.36-2.84zM16.5 3.3L15.48 0h2.04L16.5 3.3z" fill-rule="evenodd"></path></svg></div></a></span></div><div class="s ln lo lp lq mv mw mx my mz na"><div class="ky ms lu"><h4 class="ce b eu cg ek"><button class="ck cl au av aw ax ay az ba bb cm cn be co cp">3.8K<span class="s h g f mt mu"> <!-- -->claps</span></button><span class="s h g f mt mu"></span></h4></div></div></div></span></div><div class="s nb nc nd ne nf"></div><button class="lh lf az"><div class="lx n o ku"><span class="ng s h g f mt mu"><svg width="33" height="33" viewBox="0 0 33 33" fill="none" class="r" aria-label="responses"><path clip-rule="evenodd" d="M24.28 25.5l.32-.29c2.11-1.94 3.4-4.61 3.4-7.56C28 11.83 22.92 7 16.5 7S5 11.83 5 17.65s5.08 10.66 11.5 10.66c1.22 0 2.4-.18 3.5-.5l.5-.15.41.33a8.86 8.86 0 0 0 4.68 2.1 7.34 7.34 0 0 1-1.3-4.15v-.43zm1 .45c0 1.5.46 2.62 1.69 4.44.22.32.01.75-.38.75a9.69 9.69 0 0 1-6.31-2.37c-1.2.35-2.46.54-3.78.54C9.6 29.3 4 24.09 4 17.65 4 11.22 9.6 6 16.5 6S29 11.22 29 17.65c0 3.25-1.42 6.18-3.72 8.3z"></path></svg></span><span class="nh s mp mq mr e d"><svg width="25" height="25" class="r" aria-label="responses"><path d="M19.07 21.12a6.33 6.33 0 0 1-3.53-1.1 7.8 7.8 0 0 1-.7-.52c-.77.21-1.57.32-2.38.32-4.67 0-8.46-3.5-8.46-7.8C4 7.7 7.79 4.2 12.46 4.2c4.66 0 8.46 3.5 8.46 7.8 0 2.06-.85 3.99-2.4 5.45a6.28 6.28 0 0 0 1.14 2.59c.15.21.17.48.06.7a.69.69 0 0 1-.62.38h-.03zm0-1v.5l.03-.5h-.03zm-3.92-1.64l.21.2a6.09 6.09 0 0 0 3.24 1.54 7.14 7.14 0 0 1-.83-1.84 5.15 5.15 0 0 1-.16-.75 2.4 2.4 0 0 1-.02-.29v-.23l.18-.15a6.6 6.6 0 0 0 2.3-4.96c0-3.82-3.4-6.93-7.6-6.93-4.19 0-7.6 3.11-7.6 6.93 0 3.83 3.41 6.94 7.6 6.94.83 0 1.64-.12 2.41-.35l.28-.08z" fill-rule="evenodd"></path></svg></span><div class="s ky ni lz nj mb nk md nl nm nn no"><h4 class="ce b eu cg ek">28<!-- --> <span class="s h g f mt mu">response<!-- -->s</span></h4></div></div></button></div><div class="n o"><div class="gd s ap"><button class="ck cl au av aw ax ay az ba bb cm cn be co cp" aria-label="Share on twitter"><svg width="29" height="29" class="ge"><path d="M22.05 7.54a4.47 4.47 0 0 0-3.3-1.46 4.53 4.53 0 0 0-4.53 4.53c0 .35.04.7.08 1.05A12.9 12.9 0 0 1 5 6.89a5.1 5.1 0 0 0-.65 2.26c.03 1.6.83 2.99 2.02 3.79a4.3 4.3 0 0 1-2.02-.57v.08a4.55 4.55 0 0 0 3.63 4.44c-.4.08-.8.13-1.21.16l-.81-.08a4.54 4.54 0 0 0 4.2 3.15 9.56 9.56 0 0 1-5.66 1.94l-1.05-.08c2 1.27 4.38 2.02 6.94 2.02 8.3 0 12.86-6.9 12.84-12.85.02-.24 0-.43 0-.65a8.68 8.68 0 0 0 2.26-2.34c-.82.38-1.7.62-2.6.72a4.37 4.37 0 0 0 1.95-2.51c-.84.53-1.81.9-2.83 1.13z"></path></svg></button></div><div class="gd s ap"><button class="ck cl au av aw ax ay az ba bb cm cn be co cp" aria-label="Share on linkedin"><svg width="29" height="29" viewBox="0 0 29 29" fill="none" class="ge"><path d="M5 6.36C5 5.61 5.63 5 6.4 5h16.2c.77 0 1.4.61 1.4 1.36v16.28c0 .75-.63 1.36-1.4 1.36H6.4c-.77 0-1.4-.6-1.4-1.36V6.36z"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M10.76 20.9v-8.57H7.89v8.58h2.87zm-1.44-9.75c1 0 1.63-.65 1.63-1.48-.02-.84-.62-1.48-1.6-1.48-.99 0-1.63.64-1.63 1.48 0 .83.62 1.48 1.59 1.48h.01zM12.35 20.9h2.87v-4.79c0-.25.02-.5.1-.7.2-.5.67-1.04 1.46-1.04 1.04 0 1.46.8 1.46 1.95v4.59h2.87v-4.92c0-2.64-1.42-3.87-3.3-3.87-1.55 0-2.23.86-2.61 1.45h.02v-1.24h-2.87c.04.8 0 8.58 0 8.58z" fill="#fff"></path></svg></button></div><div class="gd s ap"><button class="ck cl au av aw ax ay az ba bb cm cn be co cp" aria-label="Share on facebook"><svg width="29" height="29" class="ge"><path d="M23.2 5H5.8a.8.8 0 0 0-.8.8V23.2c0 .44.35.8.8.8h9.3v-7.13h-2.38V13.9h2.38v-2.38c0-2.45 1.55-3.66 3.74-3.66 1.05 0 1.95.08 2.2.11v2.57h-1.5c-1.2 0-1.48.57-1.48 1.4v1.96h2.97l-.6 2.97h-2.37l.05 7.12h5.1a.8.8 0 0 0 .79-.8V5.8a.8.8 0 0 0-.8-.79"></path></svg></button></div><div class="np s ap"><div class="ge"><span><a href="https://medium.com/m/signin?actionUrl=%2F_%2Fbookmark%2Fp%2F1cf5a71e5a5c&amp;operation=register&amp;redirect=https%3A%2F%2Finstagram-engineering.com%2Fsharding-ids-at-instagram-1cf5a71e5a5c&amp;source=post_actions_footer--------------------------bookmark_footer-----------" class="ck cl au av aw ax ay az ba bb cm cn be co cp" rel="noopener"><svg width="25" height="25" viewBox="0 0 25 25"><path d="M19 6a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v14.66h.01c.01.1.05.2.12.28a.5.5 0 0 0 .7.03l5.67-4.12 5.66 4.13a.5.5 0 0 0 .71-.03.5.5 0 0 0 .12-.29H19V6zm-6.84 9.97L7 19.64V6a1 1 0 0 1 1-1h9a1 1 0 0 1 1 1v13.64l-5.16-3.67a.49.49 0 0 0-.68 0z" fill-rule="evenodd"></path></svg></a></span></div></div></div></div></div></div><div><div class="n p"><div class="ab ac ae af ag dk ai aj"><div class="nq bh nr mj s ns z"><div class="s g"><div class="nt nu s ky"><span class="s nv am nw"><div class="s t nx ny"><a href="https://medium.com/@InstagramEng?source=follow_footer-------------------------------------" rel="noopener"><img alt="Instagram Engineering" class="s eq bx nz" src="https://miro.medium.com/fit/c/160/160/1*8x_1IP3b75o5u9M4LgFBig.jpeg" width="80" height="80"/></a></div><span class="s"><div class="oa s ob"><p class="ce b cf oc od ch ci">Written by</p></div><div class="oa oe n ob"><div class="aj n o em"><h2 class="ce hq of og dm ek"><a href="https://medium.com/@InstagramEng?source=follow_footer-------------------------------------" class="ck cl au av aw ax ay az ba bb cm cn be co cp" rel="noopener">Instagram Engineering</a></h2><div class="s g"><span><a href="https://medium.com/m/signin?actionUrl=%2F_%2Fsubscribe%2Fuser%2Fa4c6efa67fe0%2F1cf5a71e5a5c&amp;operation=register&amp;redirect=https%3A%2F%2Finstagram-engineering.com%2Fsharding-ids-at-instagram-1cf5a71e5a5c&amp;source=follow_footer-a4c6efa67fe0-------------------------follow_footer-----------" class="ce b eu cg ff oh fh fi fj fk fl bb fm fn fo fp fq fr fs da ft fu" rel="noopener">Follow</a></span></div></div></div></span></span><div class="oa oi s ob bi"><div class="oj s"><h4 class="ce b jq ok ch"></h4></div><div class="ol om bi"><span><a href="https://medium.com/m/signin?actionUrl=%2F_%2Fsubscribe%2Fuser%2Fa4c6efa67fe0%2F1cf5a71e5a5c&amp;operation=register&amp;redirect=https%3A%2F%2Finstagram-engineering.com%2Fsharding-ids-at-instagram-1cf5a71e5a5c&amp;source=follow_footer-a4c6efa67fe0-------------------------follow_footer-----------" class="ce b eu cg ff oh fh fi fj fk fl bb fm fn fo fp fq fr fs da ft fu" rel="noopener">Follow</a></span></div></div></div><div class="nq s"></div><div class="nt nu s ky"><span class="s nv am nw"><div class="s t nx ny"><a href="https://instagram-engineering.com/?source=follow_footer-------------------------------------" rel="noopener"><img alt="Instagram Engineering" class="fq nz bx" src="https://miro.medium.com/fit/c/160/160/1*CPgwLHR6jno_tOmF0--7eg.jpeg" width="80" height="80"/></a></div><span class="s"><div class="oa oe n ob"><div class="aj n o em"><h2 class="ce hq of og dm ek"><a href="https://instagram-engineering.com/?source=follow_footer-------------------------------------" class="ck cl au av aw ax ay az ba bb cm cn be co cp" rel="noopener">Instagram Engineering</a></h2><div class="s g"><div class="ft" aria-hidden="false"><span><a href="https://medium.com/m/signin?actionUrl=%2F_%2Fsubscribe%2Fcollection%2Finstagram-engineering%2F1cf5a71e5a5c&amp;operation=register&amp;redirect=https%3A%2F%2Finstagram-engineering.com%2Fsharding-ids-at-instagram-1cf5a71e5a5c&amp;source=follow_footer--------------------------follow_footer-----------" class="ce b eu cg ff oh fh fi fj fk fl bb fm fn fo fp fq fr fs da ft fu" rel="noopener"><div class="n ku">Follow</div></a></span></div></div></div></div></span></span><div class="oa on s ob bi"><div class="oj s"><h4 class="ce b jq ok ch">Stories from the people who build @Instagram</h4></div><div class="ol om bi"><div class="ft" aria-hidden="false"><span><a href="https://medium.com/m/signin?actionUrl=%2F_%2Fsubscribe%2Fcollection%2Finstagram-engineering%2F1cf5a71e5a5c&amp;operation=register&amp;redirect=https%3A%2F%2Finstagram-engineering.com%2Fsharding-ids-at-instagram-1cf5a71e5a5c&amp;source=follow_footer--------------------------follow_footer-----------" class="ce b eu cg ff oh fh fi fj fk fl bb fm fn fo fp fq fr fs da ft fu" rel="noopener"><div class="n ku">Follow</div></a></span></div></div></div></div></div><div class="ol bi"><div class="oo s"><div class="n ku"><div class="op s"><a href="https://medium.com/@InstagramEng?source=follow_footer-------------------------------------" rel="noopener"><img alt="Instagram Engineering" class="s eq oq or" src="https://miro.medium.com/fit/c/80/80/1*8x_1IP3b75o5u9M4LgFBig.jpeg" width="40" height="40"/></a></div><div class="et s"><p class="ce b os ot ou ch ci">Written by</p><div class="n ku"><h2 class="ce hq jq cg dm ek"><a href="https://medium.com/@InstagramEng?source=follow_footer-------------------------------------" class="ck cl au av aw ax ay az ba bb cm cn be co cp" rel="noopener">Instagram Engineering</a></h2><div class="et s"><span><a href="https://medium.com/m/signin?actionUrl=%2F_%2Fsubscribe%2Fuser%2Fa4c6efa67fe0%2F1cf5a71e5a5c&amp;operation=register&amp;redirect=https%3A%2F%2Finstagram-engineering.com%2Fsharding-ids-at-instagram-1cf5a71e5a5c&amp;source=follow_footer-a4c6efa67fe0-------------------------follow_footer-----------" class="ce b cf cg ff fg fh fi fj fk fl bb fm fn fo fp fq fr fs da ft fu" rel="noopener">Follow</a></span></div></div><div class="ov s"><h4 class="ce b eu cg ch"></h4></div></div></div><div class="oo s"><div class="n ku"><a href="https://instagram-engineering.com/?source=follow_footer-------------------------------------" rel="noopener"><img alt="Instagram Engineering" class="fq or oq" src="https://miro.medium.com/fit/c/80/80/1*CPgwLHR6jno_tOmF0--7eg.jpeg" width="40" height="40"/></a><div class="et s"><div class="n ku"><h2 class="ce hq jq cg dm ek"><a href="https://instagram-engineering.com/?source=follow_footer-------------------------------------" class="ck cl au av aw ax ay az ba bb cm cn be co cp" rel="noopener">Instagram Engineering</a></h2><div class="et s"><div class="ft" aria-hidden="false"><span><a href="https://medium.com/m/signin?actionUrl=%2F_%2Fsubscribe%2Fcollection%2Finstagram-engineering%2F1cf5a71e5a5c&amp;operation=register&amp;redirect=https%3A%2F%2Finstagram-engineering.com%2Fsharding-ids-at-instagram-1cf5a71e5a5c&amp;source=follow_footer--------------------------follow_footer-----------" class="ce b cf cg ff fg fh fi fj fk fl bb fm fn fo fp fq fr fs da ft fu" rel="noopener"><div class="n ku">Follow</div></a></span></div></div></div><div class="ov s"><h4 class="ce b eu cg ch">Stories from the people who build @Instagram</h4></div></div></div></div></div></div></div></div></div><div class="s ow z"><div class="n p"><div class="ab ac ae af ag ah ai aj"><div class="ox oy s"><div class="oz ko pa oy s pb pc"><h2 class="ce hq iq is ht it iv hw iw iy ia iz jb ie jc je ii ek">More From Medium</h2></div><div class="bu n ku mi pd pe pf pg ph pi pj pk pl pm pn po pp pq pr"><div class="ps pt pu pv pw px py pz qa qb qc qd qe qf qg qh qi qj qk ql qm"><div class="qn qo s"><div class="aj qp"><div class="n em"><div class="s bp qq qr qs"><div class="qt s"><h2 class="ce hq qu qv ht qw qx hw qy qz ia ra rb ie rc rd ii ek"><a rel="noopener" href="/python-at-scale-strict-modules-c0bb9245c834?source=post_internal_links---------0----------------------------">Python at Scale: Strict Modules</a></h2></div><div class="o n"><div></div><div class="aj s"><div class="n"><div style="flex:1"><span class="ce b eu cg ek"><div class="cq n o ew"><span class="ce b cf cg ek"><a href="https://medium.com/@carlmeyer?source=post_internal_links---------0----------------------------" class="ck cl au av aw ax ay az ba bb fd be co cp" rel="noopener">Carl Meyer</a><span> <!-- -->in<!-- --> <a href="https://instagram-engineering.com/?source=post_internal_links---------0----------------------------" class="ck cl au av aw ax ay az ba bb fd be co cp" rel="noopener">Instagram Engineering</a></span></span></div></span></div></div></div></div></div><div class="et gf s re rf"><a class="ck cl au av aw ax ay az ba bb cm cn be co cp s" rel="noopener" href="/python-at-scale-strict-modules-c0bb9245c834?source=post_internal_links---------0----------------------------"><div class="rj s ky rk"><div class="rl rm s"><div class="ka rg t u v qp aj bk rh ri"><img class="t u v qp aj rn ro rp" src="https://miro.medium.com/max/60/1*hn4v1tCaJy7cWMyb0bpNpQ.png?q=20" width="70" height="70" role="presentation"/></div><img class="ka rg rq rr rs rt ru rv rw rx ry rz c" width="70" height="70" role="presentation"/><noscript><img class="rq rr rs rt ru rv rw rx ry rz" src="https://miro.medium.com/fit/c/140/140/1*hn4v1tCaJy7cWMyb0bpNpQ.png" width="70" height="70" srcSet="https://miro.medium.com/fit/c/96/140/1*hn4v1tCaJy7cWMyb0bpNpQ.png 48w, https://miro.medium.com/fit/c/140/140/1*hn4v1tCaJy7cWMyb0bpNpQ.png 70w" sizes="70px" role="presentation"/></noscript></div></div></a></div></div></div></div></div><div class="ps pt pu pv pw px py pz qa qb qc qd qe qf qg qh qi qj qk ql qm"><div class="qn qo s"><div class="aj qp"><div class="n em"><div class="s bp qq qr qs"><div class="qt s"><h2 class="ce hq qu qv ht qw qx hw qy qz ia ra rb ie rc rd ii ek"><a rel="noopener" href="/making-instagram-com-faster-part-1-62cc0c327538?source=post_internal_links---------1----------------------------">Making Instagram.com faster: Part 1</a></h2></div><div class="o n"><div></div><div class="aj s"><div class="n"><div style="flex:1"><span class="ce b eu cg ek"><div class="cq n o ew"><span class="ce b cf cg ek"><a href="https://medium.com/@mr_sharpoblunto?source=post_internal_links---------1----------------------------" class="ck cl au av aw ax ay az ba bb fd be co cp" rel="noopener">Glenn Conner</a><span> <!-- -->in<!-- --> <a href="https://instagram-engineering.com/?source=post_internal_links---------1----------------------------" class="ck cl au av aw ax ay az ba bb fd be co cp" rel="noopener">Instagram Engineering</a></span></span></div></span></div></div></div></div></div><div class="et gf s re rf"><a class="ck cl au av aw ax ay az ba bb cm cn be co cp s" rel="noopener" href="/making-instagram-com-faster-part-1-62cc0c327538?source=post_internal_links---------1----------------------------"><div class="rj s ky rk"><div class="rl rm s"><div class="ka rg t u v qp aj bk rh ri"><img class="t u v qp aj rn ro rp" src="https://miro.medium.com/max/60/1*madjA8Cbk-QVS--NyR5Q3g.png?q=20" width="70" height="70" role="presentation"/></div><img class="ka rg rq rr rs rt ru rv rw rx ry rz c" width="70" height="70" role="presentation"/><noscript><img class="rq rr rs rt ru rv rw rx ry rz" src="https://miro.medium.com/fit/c/140/140/1*madjA8Cbk-QVS--NyR5Q3g.png" width="70" height="70" srcSet="https://miro.medium.com/fit/c/96/140/1*madjA8Cbk-QVS--NyR5Q3g.png 48w, https://miro.medium.com/fit/c/140/140/1*madjA8Cbk-QVS--NyR5Q3g.png 70w" sizes="70px" role="presentation"/></noscript></div></div></a></div></div></div></div></div><div class="ps pt pu pv pw px py pz qa qb qc qd qe qf qg qh qi qj qk ql qm"><div class="qn qo s"><div class="aj qp"><div class="n em"><div class="s bp qq qr qs"><div class="qt s"><h2 class="ce hq qu qv ht qw qx hw qy qz ia ra rb ie rc rd ii ek"><a rel="noopener" href="/static-analysis-at-scale-an-instagram-story-8f498ab71a0c?source=post_internal_links---------2----------------------------">Static Analysis at Scale: An Instagram Story</a></h2></div><div class="o n"><div></div><div class="aj s"><div class="n"><div style="flex:1"><span class="ce b eu cg ek"><div class="cq n o ew"><span class="ce b cf cg ek"><a href="https://medium.com/@bgw?source=post_internal_links---------2----------------------------" class="ck cl au av aw ax ay az ba bb fd be co cp" rel="noopener">Benjamin Woodruff</a><span> <!-- -->in<!-- --> <a href="https://instagram-engineering.com/?source=post_internal_links---------2----------------------------" class="ck cl au av aw ax ay az ba bb fd be co cp" rel="noopener">Instagram Engineering</a></span></span></div></span></div></div></div></div></div><div class="et gf s re rf"><a class="ck cl au av aw ax ay az ba bb cm cn be co cp s" rel="noopener" href="/static-analysis-at-scale-an-instagram-story-8f498ab71a0c?source=post_internal_links---------2----------------------------"><div class="rj s ky rk"><div class="rl rm s"><div class="ka rg t u v qp aj bk rh ri"><img class="t u v qp aj rn ro rp" src="https://miro.medium.com/max/60/1*J7MSYdDO3yEz09sGE6yRTA.png?q=20" width="70" height="70" role="presentation"/></div><img class="ka rg rq rr rs rt ru rv rw rx ry rz c" width="70" height="70" role="presentation"/><noscript><img class="rq rr rs rt ru rv rw rx ry rz" src="https://miro.medium.com/fit/c/140/140/1*J7MSYdDO3yEz09sGE6yRTA.png" width="70" height="70" srcSet="https://miro.medium.com/fit/c/96/140/1*J7MSYdDO3yEz09sGE6yRTA.png 48w, https://miro.medium.com/fit/c/140/140/1*J7MSYdDO3yEz09sGE6yRTA.png 70w" sizes="70px" role="presentation"/></noscript></div></div></a></div></div></div></div></div><div class="ps pt pu pv pw px py pz qa qb qc qd qe qf qg qh qi qj qk ql qm"><div class="qn qo s"><div class="aj qp"><div class="n em"><div class="s bp qq qr qs"><div class="qt s"><h2 class="ce hq qu qv ht qw qx hw qy qz ia ra rb ie rc rd ii ek"><a rel="noopener" href="/making-instagram-com-faster-part-3-cache-first-6f3f130b9669?source=post_internal_links---------3----------------------------">Making instagram.com faster: Part 3 — cache first</a></h2></div><div class="o n"><div></div><div class="aj s"><div class="n"><div style="flex:1"><span class="ce b eu cg ek"><div class="cq n o ew"><span class="ce b cf cg ek"><a href="https://medium.com/@mr_sharpoblunto?source=post_internal_links---------3----------------------------" class="ck cl au av aw ax ay az ba bb fd be co cp" rel="noopener">Glenn Conner</a><span> <!-- -->in<!-- --> <a href="https://instagram-engineering.com/?source=post_internal_links---------3----------------------------" class="ck cl au av aw ax ay az ba bb fd be co cp" rel="noopener">Instagram Engineering</a></span></span></div></span></div></div></div></div></div><div class="et gf s re rf"><a class="ck cl au av aw ax ay az ba bb cm cn be co cp s" rel="noopener" href="/making-instagram-com-faster-part-3-cache-first-6f3f130b9669?source=post_internal_links---------3----------------------------"><div class="rj s ky rk"><div class="rl rm s"><div class="ka rg t u v qp aj bk rh ri"><img class="t u v qp aj rn ro rp" src="https://miro.medium.com/max/60/1*NGABlwJjUR2g0T23xTvWoQ.png?q=20" width="70" height="70" role="presentation"/></div><img class="ka rg rq rr rs rt ru rv rw rx ry rz c" width="70" height="70" role="presentation"/><noscript><img class="rq rr rs rt ru rv rw rx ry rz" src="https://miro.medium.com/fit/c/140/140/1*NGABlwJjUR2g0T23xTvWoQ.png" width="70" height="70" srcSet="https://miro.medium.com/fit/c/96/140/1*NGABlwJjUR2g0T23xTvWoQ.png 48w, https://miro.medium.com/fit/c/140/140/1*NGABlwJjUR2g0T23xTvWoQ.png 70w" sizes="70px" role="presentation"/></noscript></div></div></a></div></div></div></div></div><div class="ps pt pu pv pw px py pz qa qb qc qd qe qf qg qh qi qj qk ql qm"><div class="qn qo s"><div class="aj qp"><div class="n em"><div class="s bp qq qr qs"><div class="qt s"><h2 class="ce hq qu qv ht qw qx hw qy qz ia ra rb ie rc rd ii ek"><a rel="noopener" href="/types-for-python-http-apis-an-instagram-story-d3c3a207fdb7?source=post_internal_links---------4----------------------------">Types for Python HTTP APIs: An Instagram Story</a></h2></div><div class="o n"><div></div><div class="aj s"><div class="n"><div style="flex:1"><span class="ce b eu cg ek"><div class="cq n o ew"><span class="ce b cf cg ek"><a href="https://medium.com/@apadmarao?source=post_internal_links---------4----------------------------" class="ck cl au av aw ax ay az ba bb fd be co cp" rel="noopener">Anirudh Padmarao</a><span> <!-- -->in<!-- --> <a href="https://instagram-engineering.com/?source=post_internal_links---------4----------------------------" class="ck cl au av aw ax ay az ba bb fd be co cp" rel="noopener">Instagram Engineering</a></span></span></div></span></div></div></div></div></div><div class="et gf s re rf"><a class="ck cl au av aw ax ay az ba bb cm cn be co cp s" rel="noopener" href="/types-for-python-http-apis-an-instagram-story-d3c3a207fdb7?source=post_internal_links---------4----------------------------"><div class="rj s ky rk"><div class="rl rm s"><div class="ka rg t u v qp aj bk rh ri"><img class="t u v qp aj rn ro rp" src="https://miro.medium.com/max/60/1*nN1d8smYVl_pBPUdcowtEg.png?q=20" width="70" height="70" role="presentation"/></div><img class="ka rg rq rr rs rt ru rv rw rx ry rz c" width="70" height="70" role="presentation"/><noscript><img class="rq rr rs rt ru rv rw rx ry rz" src="https://miro.medium.com/fit/c/140/140/1*nN1d8smYVl_pBPUdcowtEg.png" width="70" height="70" srcSet="https://miro.medium.com/fit/c/96/140/1*nN1d8smYVl_pBPUdcowtEg.png 48w, https://miro.medium.com/fit/c/140/140/1*nN1d8smYVl_pBPUdcowtEg.png 70w" sizes="70px" role="presentation"/></noscript></div></div></a></div></div></div></div></div><div class="ps pt pu pv pw px py pz qa qb qc qd qe qf qg qh qi qj qk ql qm"><div class="qn qo s"><div class="aj qp"><div class="n em"><div class="s bp qq qr qs"><div class="qt s"><h2 class="ce hq qu qv ht qw qx hw qy qz ia ra rb ie rc rd ii ek"><a rel="noopener" href="/making-instagram-com-faster-code-size-and-execution-optimizations-part-4-57668be796a8?source=post_internal_links---------5----------------------------">Making instagram.com faster: Code size and execution optimizations (Part 4)</a></h2></div><div class="o n"><div></div><div class="aj s"><div class="n"><div style="flex:1"><span class="ce b eu cg ek"><div class="cq n o ew"><span class="ce b cf cg ek"><a href="https://medium.com/@mr_sharpoblunto?source=post_internal_links---------5----------------------------" class="ck cl au av aw ax ay az ba bb fd be co cp" rel="noopener">Glenn Conner</a><span> <!-- -->in<!-- --> <a href="https://instagram-engineering.com/?source=post_internal_links---------5----------------------------" class="ck cl au av aw ax ay az ba bb fd be co cp" rel="noopener">Instagram Engineering</a></span></span></div></span></div></div></div></div></div><div class="et gf s re rf"><a class="ck cl au av aw ax ay az ba bb cm cn be co cp s" rel="noopener" href="/making-instagram-com-faster-code-size-and-execution-optimizations-part-4-57668be796a8?source=post_internal_links---------5----------------------------"><div class="rj s ky rk"><div class="rl rm s"><div class="ka rg t u v qp aj bk rh ri"><img class="t u v qp aj rn ro rp" src="https://miro.medium.com/max/60/1*HDLCFPZCIfOpVWMSYz4HOg.png?q=20" width="70" height="70" role="presentation"/></div><img class="ka rg rq rr rs rt ru rv rw rx ry rz c" width="70" height="70" role="presentation"/><noscript><img class="rq rr rs rt ru rv rw rx ry rz" src="https://miro.medium.com/fit/c/140/140/1*HDLCFPZCIfOpVWMSYz4HOg.png" width="70" height="70" srcSet="https://miro.medium.com/fit/c/96/140/1*HDLCFPZCIfOpVWMSYz4HOg.png 48w, https://miro.medium.com/fit/c/140/140/1*HDLCFPZCIfOpVWMSYz4HOg.png 70w" sizes="70px" role="presentation"/></noscript></div></div></a></div></div></div></div></div><div class="ps pt pu pv pw px py pz qa qb qc qd qe qf qg qh qi qj qk ql qm"><div class="qn qo s"><div class="aj qp"><div class="n em"><div class="s bp qq qr qs"><div class="qt s"><h2 class="ce hq qu qv ht qw qx hw qy qz ia ra rb ie rc rd ii ek"><a rel="noopener" href="/thundering-herds-promises-82191c8af57d?source=post_internal_links---------6----------------------------">Thundering Herds &amp; Promises</a></h2></div><div class="o n"><div></div><div class="aj s"><div class="n"><div style="flex:1"><span class="ce b eu cg ek"><div class="cq n o ew"><span class="ce b cf cg ek"><a href="https://medium.com/@nickmvcooper?source=post_internal_links---------6----------------------------" class="ck cl au av aw ax ay az ba bb fd be co cp" rel="noopener">Nick Cooper</a><span> <!-- -->in<!-- --> <a href="https://instagram-engineering.com/?source=post_internal_links---------6----------------------------" class="ck cl au av aw ax ay az ba bb fd be co cp" rel="noopener">Instagram Engineering</a></span></span></div></span></div></div></div></div></div><div class="et gf s re rf"><a class="ck cl au av aw ax ay az ba bb cm cn be co cp s" rel="noopener" href="/thundering-herds-promises-82191c8af57d?source=post_internal_links---------6----------------------------"><div class="rj s ky rk"><div class="rl rm s"><div class="ka rg t u v qp aj bk rh ri"><img class="t u v qp aj rn ro rp" src="https://miro.medium.com/max/60/0*s8g4LHW_M5OfTrU_?q=20" width="70" height="70" role="presentation"/></div><img class="ka rg rq rr rs rt ru rv rw rx ry rz c" width="70" height="70" role="presentation"/><noscript><img class="rq rr rs rt ru rv rw rx ry rz" src="https://miro.medium.com/fit/c/140/140/0*s8g4LHW_M5OfTrU_" width="70" height="70" srcSet="https://miro.medium.com/fit/c/96/140/0*s8g4LHW_M5OfTrU_ 48w, https://miro.medium.com/fit/c/140/140/0*s8g4LHW_M5OfTrU_ 70w" sizes="70px" role="presentation"/></noscript></div></div></a></div></div></div></div></div><div class="ps pt pu pv pw px py pz qa qb qc qd qe qf qg qh qi qj qk ql qm"><div class="qn qo s"><div class="aj qp"><div class="n em"><div class="s bp qq qr qs"><div class="qt s"><h2 class="ce hq qu qv ht qw qx hw qy qz ia ra rb ie rc rd ii ek"><a rel="noopener" href="/profiling-cpython-at-instagram-89d4cbeeb898?source=post_internal_links---------7----------------------------">Profiling CPython at Instagram</a></h2></div><div class="o n"><div></div><div class="aj s"><div class="n"><div style="flex:1"><span class="ce b eu cg ek"><div class="cq n o ew"><span class="ce b cf cg ek"><a href="https://medium.com/@InstagramEng?source=post_internal_links---------7----------------------------" class="ck cl au av aw ax ay az ba bb fd be co cp" rel="noopener">Instagram Engineering</a><span> <!-- -->in<!-- --> <a href="https://instagram-engineering.com/?source=post_internal_links---------7----------------------------" class="ck cl au av aw ax ay az ba bb fd be co cp" rel="noopener">Instagram Engineering</a></span></span></div></span></div></div></div></div></div><div class="et gf s re rf"><a class="ck cl au av aw ax ay az ba bb cm cn be co cp s" rel="noopener" href="/profiling-cpython-at-instagram-89d4cbeeb898?source=post_internal_links---------7----------------------------"><div class="rj s ky rk"><div class="rl rm s"><div class="ka rg t u v qp aj bk rh ri"><img class="t u v qp aj rn ro rp" src="https://miro.medium.com/max/60/1*PaVxVUG89fMe9KTc-L8dew.jpeg?q=20" width="70" height="70" role="presentation"/></div><img class="ka rg rq rr rs rt ru rv rw rx ry rz c" width="70" height="70" role="presentation"/><noscript><img class="rq rr rs rt ru rv rw rx ry rz" src="https://miro.medium.com/fit/c/140/140/1*PaVxVUG89fMe9KTc-L8dew.jpeg" width="70" height="70" srcSet="https://miro.medium.com/fit/c/96/140/1*PaVxVUG89fMe9KTc-L8dew.jpeg 48w, https://miro.medium.com/fit/c/140/140/1*PaVxVUG89fMe9KTc-L8dew.jpeg 70w" sizes="70px" role="presentation"/></noscript></div></div></a></div></div></div></div></div></div></div></div></div></div></div></div></div><div class="sa s sb sc"><div class="n p"><div class="ab ac ae af ag ah ai aj"><div class="sd se nt n em g"><div class="sf n em"><div class="sg s sh"><div class="qt s"><a href="https://medium.com/about?autoplay=1&amp;source=post_page-----1cf5a71e5a5c--------------------------------" class="ck cl au av aw ax ay az ba bb si sj be sk sl" rel="noopener"><h2 class="ce hq sm ok dm sn">Learn more.</h2></a></div><h4 class="ce b eu cg so">Medium<!-- --> is an open platform where 170 million readers come to find insightful and dynamic thinking. Here, expert and undiscovered voices alike dive into the heart of any topic and bring new ideas to the surface.<!-- --> <a href="https://medium.com/about?autoplay=1&amp;source=post_page-----1cf5a71e5a5c--------------------------------" class="ck cl au av aw ax ay az ba bb be sk sl hf" rel="noopener">Learn more</a></h4></div><div class="sg s sh"><div class="qt s"><a href="https://medium.com/topics?source=post_page-----1cf5a71e5a5c--------------------------------" class="ck cl au av aw ax ay az ba bb si sj be sk sl" rel="noopener"><h2 class="ce hq sm ok dm sn">Make <!-- -->Medium<!-- --> yours.</h2></a></div><h4 class="ce b eu cg so">Follow the writers, publications, and topics that matter to you, and you’ll see them on your homepage and in your inbox.<!-- --> <a href="https://medium.com/topics?source=post_page-----1cf5a71e5a5c--------------------------------" class="ck cl au av aw ax ay az ba bb be sk sl hf" rel="noopener">Explore</a></h4></div><div class="sg s sh"><div class="qt s"><a href="https://about.medium.com/creators/?source=post_page-----1cf5a71e5a5c--------------------------------" class="ck cl au av aw ax ay az ba bb si sj be sk sl" rel="noopener"><h2 class="ce hq sm ok dm sn">Share your thinking.</h2></a></div><h4 class="ce b eu cg so">If you have a story to tell, knowledge to share, or a perspective to offer — welcome home. It’s easy and free to post your thinking on any topic.<!-- --> <a href="https://about.medium.com/creators/?source=post_page-----1cf5a71e5a5c--------------------------------" class="ck cl au av aw ax ay az ba bb be sk sl hf" rel="noopener">Write on <!-- -->Medium</a></h4></div></div></div><div class="n km"><div class="n o em"><a href="https://medium.com/?source=post_page-----1cf5a71e5a5c--------------------------------" aria-label="Go to homepage" class="ck cl au av aw ax ay az ba bb si sj be sk sl" rel="noopener"><svg viewBox="0 0 3940 610" class="fh sp"><path d="M594.79 308.2c0 163.76-131.85 296.52-294.5 296.52S5.8 472 5.8 308.2 137.65 11.69 300.29 11.69s294.5 132.75 294.5 296.51M917.86 308.2c0 154.16-65.93 279.12-147.25 279.12s-147.25-125-147.25-279.12S689.29 29.08 770.61 29.08s147.25 125 147.25 279.12M1050 308.2c0 138.12-23.19 250.08-51.79 250.08s-51.79-112-51.79-250.08 23.19-250.08 51.8-250.08S1050 170.09 1050 308.2M1862.77 37.4l.82-.18v-6.35h-167.48l-155.51 365.5-155.51-365.5h-180.48v6.35l.81.18c30.57 6.9 46.09 17.19 46.09 54.3v434.45c0 37.11-15.58 47.4-46.15 54.3l-.81.18V587H1327v-6.35l-.81-.18c-30.57-6.9-46.09-17.19-46.09-54.3V116.9L1479.87 587h11.33l205.59-483.21V536.9c-2.62 29.31-18 38.36-45.68 44.61l-.82.19v6.3h213.3v-6.3l-.82-.19c-27.71-6.25-43.46-15.3-46.08-44.61l-.14-445.2h.14c0-37.11 15.52-47.4 46.08-54.3m97.43 287.8c3.49-78.06 31.52-134.4 78.56-135.37 14.51.24 26.68 5 36.14 14.16 20.1 19.51 29.55 60.28 28.09 121.21zm-2.11 22h250v-1.05c-.71-59.69-18-106.12-51.34-138-28.82-27.55-71.49-42.71-116.31-42.71h-1c-23.26 0-51.79 5.64-72.09 15.86-23.11 10.7-43.49 26.7-60.45 47.7-27.3 33.83-43.84 79.55-47.86 130.93-.13 1.54-.24 3.08-.35 4.62s-.18 2.92-.25 4.39a332.64 332.64 0 0 0-.36 21.69C1860.79 507 1923.65 600 2035.3 600c98 0 155.07-71.64 169.3-167.8l-7.19-2.53c-25 51.68-69.9 83-121 79.18-69.76-5.22-123.2-75.95-118.35-161.63m532.69 157.68c-8.2 19.45-25.31 30.15-48.24 30.15s-43.89-15.74-58.78-44.34c-16-30.7-24.42-74.1-24.42-125.51 0-107 33.28-176.21 84.79-176.21 21.57 0 38.55 10.7 46.65 29.37zm165.84 76.28c-30.57-7.23-46.09-18-46.09-57V5.28L2424.77 60v6.7l1.14-.09c25.62-2.07 43 1.47 53.09 10.79 7.9 7.3 11.75 18.5 11.75 34.26v71.14c-18.31-11.69-40.09-17.38-66.52-17.38-53.6 0-102.59 22.57-137.92 63.56-36.83 42.72-56.3 101.1-56.3 168.81C2230 518.72 2289.53 600 2378.13 600c51.83 0 93.53-28.4 112.62-76.3V588h166.65v-6.66zm159.29-505.33c0-37.76-28.47-66.24-66.24-66.24-37.59 0-67 29.1-67 66.24s29.44 66.24 67 66.24c37.77 0 66.24-28.48 66.24-66.24m43.84 505.33c-30.57-7.23-46.09-18-46.09-57h-.13V166.65l-166.66 47.85v6.5l1 .09c36.06 3.21 45.93 15.63 45.93 57.77V588h166.8v-6.66zm427.05 0c-30.57-7.23-46.09-18-46.09-57V166.65L3082 212.92v6.52l.94.1c29.48 3.1 38 16.23 38 58.56v226c-9.83 19.45-28.27 31-50.61 31.78-36.23 0-56.18-24.47-56.18-68.9V166.66l-166.66 47.85V221l1 .09c36.06 3.2 45.94 15.62 45.94 57.77v191.27a214.48 214.48 0 0 0 3.47 39.82l3 13.05c14.11 50.56 51.08 77 109 77 49.06 0 92.06-30.37 111-77.89v66h166.66v-6.66zM3934.2 588v-6.67l-.81-.19c-33.17-7.65-46.09-22.07-46.09-51.43v-243.2c0-75.83-42.59-121.09-113.93-121.09-52 0-95.85 30.05-112.73 76.86-13.41-49.6-52-76.86-109.06-76.86-50.12 0-89.4 26.45-106.25 71.13v-69.87l-166.66 45.89v6.54l1 .09c35.63 3.16 45.93 15.94 45.93 57V588h155.5v-6.66l-.82-.2c-26.46-6.22-35-17.56-35-46.66V255.72c7-16.35 21.11-35.72 49-35.72 34.64 0 52.2 24 52.2 71.28V588h155.54v-6.66l-.82-.2c-26.46-6.22-35-17.56-35-46.66v-248a160.45 160.45 0 0 0-2.2-27.68c7.42-17.77 22.34-38.8 51.37-38.8 35.13 0 52.2 23.31 52.2 71.28V588z"></path></svg></a><h4 class="ce b eu cg so"><div class="ov sq n em sr am"><h4 class="ce b jq ok sn"><a href="https://medium.com/about?autoplay=1&amp;source=post_page-----1cf5a71e5a5c--------------------------------" class="ck cl au av aw ax ay az ba bb fd be sk sl" rel="noopener">About</a></h4><h4 class="ce b jq ok sn"><a href="https://help.medium.com/hc/en-us?source=post_page-----1cf5a71e5a5c--------------------------------" class="ck cl au av aw ax ay az ba bb fd be sk sl" rel="noopener">Help</a></h4><h4 class="ce b jq ok sn"><a href="https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----1cf5a71e5a5c--------------------------------" class="ck cl au av aw ax ay az ba bb fd be sk sl" rel="noopener">Legal</a></h4></div></h4></div><div class="ol ss st am"><h4 class="ce b jq ok so">Get the Medium app</h4></div><div class="ol ss su am sv"><div class="sw s"><a href="https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&amp;mt=8&amp;ct=post_page&amp;source=post_page-----1cf5a71e5a5c--------------------------------" class="ck cl au av aw ax ay az ba bb si sj be sk sl" rel="noopener"><img alt="A button that says &#x27;Download on the App Store&#x27;, and if clicked it will lead you to the iOS App store" class="" src="https://miro.medium.com/max/270/1*Crl55Tm6yDNMoucPo1tvDg.png" width="135" height="41"/></a></div><div class="s"><a href="https://play.google.com/store/apps/details?id=com.medium.reader&amp;source=post_page-----1cf5a71e5a5c--------------------------------" class="ck cl au av aw ax ay az ba bb si sj be sk sl" rel="noopener"><img alt="A button that says &#x27;Get it on, Google Play&#x27;, and if clicked it will lead you to the Google Play store" class="" src="https://miro.medium.com/max/270/1*W_RAPQ62h0em559zluJLdQ.png" width="135" height="41"/></a></div></div></div></div></div></div></div></div></div><script>window.__BUILD_ID__ = "main-20210205-225312-53de49ecac"</script><script>window.__GRAPHQL_URI__ = "https://instagram-engineering.com/_/graphql"</script><script>window.__PRELOADED_STATE__ = {"auroraPage":{"isAuroraPageEnabled":false},"cache":{"group":"control","tags":[]},"client":{"isBot":false,"isEu":false,"isUs":true,"isNativeMedium":false,"isSafariMobile":false,"isSafari":false,"inAppBrowserName":"","routingEntity":{"type":"COLLECTION","id":"37dc2a3034f2","explicit":true},"supportsWebp":false},"config":{"nodeEnv":"production","version":"main-20210205-225312-53de49ecac","target":"production","productName":"Medium","publicUrl":"https:\u002F\u002Fcdn-client.medium.com\u002Flite","authDomain":"medium.com","authGoogleClientId":"216296035834-k1k6qe060s2tp2a2jam4ljdcms00sttg.apps.googleusercontent.com","favicon":"production","glyphUrl":"https:\u002F\u002Fglyph.medium.com","branchKey":"key_live_ofxXr2qTrrU9NqURK8ZwEhknBxiI6KBm","lightStep":{"name":"lite-web","host":"lightstep.medium.systems","token":"ce5be895bef60919541332990ac9fef2","appVersion":"main-20210205-225312-53de49ecac"},"algolia":{"appId":"MQ57UUUQZ2","apiKeySearch":"394474ced050e3911ae2249ecc774921","indexPrefix":"medium_","host":"-dsn.algolia.net"},"recaptchaKey":"6Lfc37IUAAAAAKGGtC6rLS13R1Hrw_BqADfS1LRk","recaptcha3Key":"6Lf8R9wUAAAAABMI_85Wb8melS7Zj6ziuf99Yot5","datadog":{"clientToken":"pub853ea8d17ad6821d9f8f11861d23dfed","context":{"deployment":{"target":"production","tag":"main-20210205-225312-53de49ecac","commit":"53de49ecac2c4aca4582364178202a2e3074ed9e"}},"datacenter":"us"},"isAmp":false,"googleAnalyticsCode":"UA-24232453-2","signInWallCustomDomainCollectionIds":["3a8144eabfe3","336d898217ee","61061eb0c96b","138adf9c44c","819cc2aaeee0"],"mediumOwnedAndOperatedCollectionIds":["544c7006046e","bcc38c8f6edf","444d13b52878","8d6b8a439e32","92d2092dc598","1285ba81cada","cb8577c9149e","8ccfed20cbb2","ae2a65f35510","3f6ecf56618","7b6769f2748b","fc8964313712","ef8e90590e66","191186aaafa0","d944778ce714","bdc4052bbdba","88d9857e584e","9dc80918cc93","8a9336e5bb4","cef6983b292","54c98c43354d","193b68bd4fba","b7e45b22fec3","55760f21cdc5"],"tierOneDomains":["medium.com","thebolditalic.com","arcdigital.media","towardsdatascience.com","uxdesign.cc","codeburst.io","psiloveyou.xyz","writingcooperative.com","entrepreneurshandbook.co","prototypr.io","betterhumans.coach.me","theascent.pub"],"topicsToFollow":["d61cf867d93f","8a146bc21b28","1eca0103fff3","4d562ee63426","aef1078a3ef5","e15e46793f8d","6158eb913466","55f1c20aba7a","3d18b94f6858","4861fee224fd","63c6f1f93ee","1d98b3a9a871","decb52b64abf","ae5d4995e225","830cded25262"],"defaultImages":{"avatar":{"imageId":"1*dmbNkD5D-u45r44go_cf0g.png","height":150,"width":150},"orgLogo":{"imageId":"1*OMF3fSqH8t4xBJ9-6oZDZw.png","height":106,"width":545},"postLogo":{"imageId":"1*kFrc4tBFM_tCis-2Ic87WA.png","height":810,"width":1440},"postPreviewImage":{"imageId":"1*hn4v1tCaJy7cWMyb0bpNpQ.png","height":386,"width":579}},"performanceTags":[],"collectionStructuredData":{"8d6b8a439e32":{"name":"Elemental","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fcdn-images-1.medium.com\u002Fmax\u002F980\u002F1*9ygdqoKprhwuTVKUM0DLPA@2x.png","width":980,"height":159}}},"3f6ecf56618":{"name":"Forge","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fcdn-images-1.medium.com\u002Fmax\u002F596\u002F1*uULpIlImcO5TDuBZ6lm7Lg@2x.png","width":596,"height":183}}},"ae2a65f35510":{"name":"GEN","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fmiro.medium.com\u002Fmax\u002F264\u002F1*RdVZMdvfV3YiZTw6mX7yWA.png","width":264,"height":140}}},"88d9857e584e":{"name":"LEVEL","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fmiro.medium.com\u002Fmax\u002F540\u002F1*JqYMhNX6KNNb2UlqGqO2WQ.png","width":540,"height":108}}},"7b6769f2748b":{"name":"Marker","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fcdn-images-1.medium.com\u002Fmax\u002F383\u002F1*haCUs0wF6TgOOvfoY-jEoQ@2x.png","width":383,"height":92}}},"444d13b52878":{"name":"OneZero","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fmiro.medium.com\u002Fmax\u002F540\u002F1*cw32fIqCbRWzwJaoQw6BUg.png","width":540,"height":123}}},"8ccfed20cbb2":{"name":"Zora","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fmiro.medium.com\u002Fmax\u002F540\u002F1*tZUQqRcCCZDXjjiZ4bDvgQ.png","width":540,"height":106}}}},"embeddedPostIds":{"coronavirus":"cd3010f9d81f"},"sharedCdcMessaging":{"COVID_APPLICABLE_TAG_SLUGS":[],"COVID_APPLICABLE_TOPIC_NAMES":[],"COVID_APPLICABLE_TOPIC_NAMES_FOR_TOPIC_PAGE":[],"COVID_MESSAGES":{"tierA":{"text":"For more information on the novel coronavirus and Covid-19, visit cdc.gov.","markups":[{"start":66,"end":73,"href":"https:\u002F\u002Fwww.cdc.gov\u002Fcoronavirus\u002F2019-nCoV"}]},"tierB":{"text":"Anyone can publish on Medium per our Policies, but we don’t fact-check every story. For more info about the coronavirus, see cdc.gov.","markups":[{"start":37,"end":45,"href":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Fcategories\u002F201931128-Policies-Safety"},{"start":125,"end":132,"href":"https:\u002F\u002Fwww.cdc.gov\u002Fcoronavirus\u002F2019-nCoV"}]},"paywall":{"text":"This article has been made free for everyone, thanks to Medium Members. For more information on the novel coronavirus and Covid-19, visit cdc.gov.","markups":[{"start":56,"end":70,"href":"https:\u002F\u002Fmedium.com\u002Fmembership"},{"start":138,"end":145,"href":"https:\u002F\u002Fwww.cdc.gov\u002Fcoronavirus\u002F2019-nCoV"}]},"unbound":{"text":"This article is free for everyone, thanks to Medium Members. For more information on the novel coronavirus and Covid-19, visit cdc.gov.","markups":[{"start":45,"end":59,"href":"https:\u002F\u002Fmedium.com\u002Fmembership"},{"start":127,"end":134,"href":"https:\u002F\u002Fwww.cdc.gov\u002Fcoronavirus\u002F2019-nCoV"}]}},"COVID_BANNER_POST_ID_OVERRIDE_WHITELIST":["3b31a67bff4a"]},"sharedVoteMessaging":{"TAGS":["politics","election-2020","government","us-politics","election","2020-presidential-race","trump","donald-trump","democrats","republicans","congress","republican-party","democratic-party","biden","joe-biden","maga"],"TOPICS":["politics","election"],"MESSAGE":{"text":"Find out more about the U.S. election results here.","markups":[{"start":46,"end":50,"href":"https:\u002F\u002Fcookpolitical.com\u002F2020-national-popular-vote-tracker"}]},"EXCLUDE_POSTS":["397ef29e3ca5"]},"embedPostRules":[],"recircOptions":{"v1":{"limit":3},"v2":{"limit":8}},"braintreeClientKey":"production_zjkj96jm_m56f8fqpf7ngnrd4","paypalClientId":"AXj1G4fotC2GE8KzWX9mSxCH1wmPE3nJglf4Z2ig_amnhvlMVX87otaq58niAg9iuLktVNF_1WCMnN7v","stripePublishableKey":"pk_live_7FReX44VnNIInZwrIIx6ghjl","errorTracking":"none"},"debug":{"requestId":"434ede2d-d935-4f7e-8597-31a493487e42","branchDeployConfig":null,"originalSpanCarrier":{"ot-tracer-spanid":"635f9c7801c81f8f","ot-tracer-traceid":"5f5992465e0056d8","ot-tracer-sampled":"true"}},"multiVote":{"clapsPerPost":{}},"navigation":{"branch":{"show":null,"hasRendered":null,"blockedByCTA":false},"hideGoogleOneTap":false,"hasRenderedGoogleOneTap":null,"hasRenderedAlternateUserBanner":null,"currentLocation":"https:\u002F\u002Finstagram-engineering.com\u002Fsharding-ids-at-instagram-1cf5a71e5a5c","host":"instagram-engineering.com","hostname":"instagram-engineering.com","susiModal":{"step":null,"operation":"register"},"postRead":false},"session":{"user":{"id":"lo_41495587c3ef"},"xsrf":"","isSpoofed":false},"tracing":{}}</script><script>window.__APOLLO_STATE__ = {"ROOT_QUERY":{"__typename":"Query","variantFlags":[{"__typename":"VariantFlag","name":"allow_access","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"allow_signup","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"allow_test_auth","valueType":{"__typename":"VariantFlagString","value":"disallow"}},{"__typename":"VariantFlag","name":"android_enable_lock_responses","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"assign_default_topic_to_posts","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"available_annual_plan","valueType":{"__typename":"VariantFlagString","value":"2c754bcc2995"}},{"__typename":"VariantFlag","name":"available_monthly_plan","valueType":{"__typename":"VariantFlagString","value":"60e220181034"}},{"__typename":"VariantFlag","name":"bane_add_user","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"bane_verify_domain","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"branch_seo_metadata","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"browsable_stream_config_bucket","valueType":{"__typename":"VariantFlagString","value":"curated-topics"}},{"__typename":"VariantFlag","name":"coronavirus_topic_recirc","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"covid_19_cdc_banner","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"default_seo_post_titles","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"disable_android_subscription_activity_carousel","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"disable_ios_resume_reading_toast","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"disable_ios_subscription_activity_carousel","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"disable_mobile_featured_chunk","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"disable_post_recommended_from_friends_provider","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_android_local_currency","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_annual_renewal_reminder_email","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_app_flirty_thirty","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_apple_parse_expires_at","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_apple_sign_in","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_apple_webhook","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_apple_webhook_renewal_failure","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_aurora_about_page_routing","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_aurora_general_admission","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_aurora_nav","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_aurora_profile_page","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_aurora_pub_follower_page","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_aurora_recirc","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_aurora_sticky_nav","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_aurora_tag_page_routing","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_author_autotier","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_automated_mission_control_triggers","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_braintree_apple_pay","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_braintree_client","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_braintree_integration","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_braintree_paypal","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_braintree_webhook","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_branch_io","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_branch_text_me_the_app","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_branding","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_branding_fonts","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_cleansweep_double_writes","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_client_error_tracking","valueType":{"__typename":"VariantFlagString","value":"none"}},{"__typename":"VariantFlag","name":"enable_confirm_sign_in","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_cta_meter","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_curation_priority_queue_experiment","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_dedicated_series_tab_api_ios","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_digest_feature_logging","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_digest_tagline","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_earn_redirect","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_edit_alt_text","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_email_sign_in_captcha","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_email_to_subscribers_after_publish","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_embedding_based_diversification","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_end_of_post_cleanup","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_evhead_com_to_ev_medium_com_redirect","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_expanded_feature_chunk_pool","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_filter_by_resend_rules","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_filter_expire_processor","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_footer_app_buttons","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_fyf_authors_and_collections","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_fyf_rex_sourcing","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_global_susi_modal","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_google_one_tap","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_google_webhook","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_google_webhook_subscription_cancelled","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_highlander_member_digest","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_hightower_user_minimum_guarantee","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_homepage_who_to_follow_module","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_homepage_write_button","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_increased_digest_timeout","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_ios_post_stats","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_json_logs_trained_ranker","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_kbfd_rex","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_kbfd_rex_app_highlights","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_kbfd_rex_daily_digest","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_lite_homepage","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_lite_homepage_feed","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_lite_notifications","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_lite_pay_page","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_lite_post","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_lite_post_cd","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_lite_pub_homepage_for_selected_domains","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_lite_server_upstream_deadlines","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_lite_stories","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_lite_threaded_responses","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_lite_topics","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_lite_unread_notification_count_mutation","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_lock_responses","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_login_code_flow","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_marketing_emails","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_media_resource_try_catch","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_medium2_kbfd","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_membership_remove_section_a","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_miro_on_kubernetes","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_mission_control","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_ml_rank_modules","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_ml_rank_rex_anno","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_mute","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_new_checkout_flow","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_new_collaborative_filtering_data","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_new_three_dot_menu","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_parsely","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_patronus_on_kubernetes","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_popularity_feature","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_post_import","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_post_page_nav_stickiness_removal","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_post_settings_screen","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_primary_topic_for_mobile","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_profile_design_reminder","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_profile_page_seo_titles","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_publish_to_email_for_publication_posts","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_responses_2","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_responses_all","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_responses_edit_and_delete","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_responses_moderation","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_rex_follow_feed_cache","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_rito_upstream_deadlines","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_rtr_channel","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_s3_sites","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_save_to_medium","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_signup_friction","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_starspace","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_starspace_ranker_starspace","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_tick_landing_page","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_tipalti_onboarding","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_trending_posts_diversification","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_tribute_landing_page","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_triton_predictions","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_trumpland_landing_page","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_twitter_auth_suggestions","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_unfiltered_cf","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_untruncated_author_post_as_email","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"glyph_font_set","valueType":{"__typename":"VariantFlagString","value":"m2-unbound"}},{"__typename":"VariantFlag","name":"google_sign_in_android","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"ios_enable_generic_home_modules","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"ios_enable_home_post_menu","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"ios_enable_iceland_paywall","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"ios_enable_lock_responses","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"ios_iceland_nux","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"ios_pub_follow_email_opt_in","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"is_not_medium_subscriber","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"kill_fastrak","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"kill_stripe_express","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"limit_post_referrers","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"limit_user_follows","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"make_nav_sticky","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"new_transition_page","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"provider_for_credit_card_form","valueType":{"__typename":"VariantFlagString","value":"BRAINTREE"}},{"__typename":"VariantFlag","name":"pub_sidebar","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"redefine_average_post_reading_time","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"remove_post_post_similarity","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"retrained_ranker","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"sign_up_with_email_button","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"signin_services","valueType":{"__typename":"VariantFlagString","value":"twitter,facebook,google,email,google-fastidv,google-one-tap,apple"}},{"__typename":"VariantFlag","name":"signup_services","valueType":{"__typename":"VariantFlagString","value":"twitter,facebook,google,email,google-fastidv,google-one-tap,apple"}},{"__typename":"VariantFlag","name":"skip_sign_in_recaptcha","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"suppress_apple_missing_expires_date_alert","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"use_new_admin_topic_backend","valueType":{"__typename":"VariantFlagBoolean","value":true}}],"viewer":null,"meterPost({\"postId\":\"1cf5a71e5a5c\",\"postMeteringOptions\":{}})":{"__ref":"MeteringInfo:{}"},"postResult({\"id\":\"1cf5a71e5a5c\"})":{"__ref":"Post:1cf5a71e5a5c"}},"MeteringInfo:{}":{"__typename":"MeteringInfo","postIds":[],"maxUnlockCount":3,"unlocksRemaining":3},"ImageMetadata:":{"id":"","__typename":"ImageMetadata","focusPercentX":null,"focusPercentY":null,"originalHeight":null,"originalWidth":null},"ImageMetadata:1*CPgwLHR6jno_tOmF0--7eg.jpeg":{"id":"1*CPgwLHR6jno_tOmF0--7eg.jpeg","__typename":"ImageMetadata","originalWidth":1000,"originalHeight":1000},"User:a4c6efa67fe0":{"id":"a4c6efa67fe0","__typename":"User","isFollowing":false,"viewerIsUser":false,"isSuspended":false,"name":"Instagram Engineering","hasCompletedProfile":false,"bio":"","imageId":"1*8x_1IP3b75o5u9M4LgFBig.jpeg","customStyleSheet":null,"hasDomain":false,"username":"InstagramEng","isAuroraVisible":true,"socialStats":{"__typename":"SocialStats","followerCount":22087},"isBlocking":false,"mediumMemberAt":0,"isMuting":false,"allowNotes":true,"newsletterV3":null,"twitterScreenName":"","isPartnerProgramEnrolled":false},"Collection:37dc2a3034f2":{"id":"37dc2a3034f2","__typename":"Collection","domain":"instagram-engineering.com","googleAnalyticsId":null,"slug":"instagram-engineering","colorBehavior":"ACCENT_COLOR","isAuroraVisible":false,"favicon":{"__ref":"ImageMetadata:"},"name":"Instagram Engineering","colorPalette":{"__typename":"ColorPalette","highlightSpectrum":{"__typename":"ColorSpectrum","backgroundColor":"#FFFFFFFF","colorPoints":[{"__typename":"ColorPoint","color":"#FFFFFFFF","point":0},{"__typename":"ColorPoint","color":"#FFE8F3E8","point":0.1},{"__typename":"ColorPoint","color":"#FFE8F3E8","point":0.2},{"__typename":"ColorPoint","color":"#FFD1E7D1","point":0.6},{"__typename":"ColorPoint","color":"#FFA3D0A2","point":1}]},"defaultBackgroundSpectrum":{"__typename":"ColorSpectrum","backgroundColor":"#FFFFFFFF","colorPoints":[{"__typename":"ColorPoint","color":"#FF1A8917","point":0},{"__typename":"ColorPoint","color":"#FF11800E","point":0.1},{"__typename":"ColorPoint","color":"#FF0F730C","point":0.2},{"__typename":"ColorPoint","color":"#FF095407","point":1}]},"tintBackgroundSpectrum":null},"customStyleSheet":null,"tagline":"Stories from the people who build @Instagram","isAuroraEligible":false,"viewerIsEditor":false,"logo":{"__ref":"ImageMetadata:1*CPgwLHR6jno_tOmF0--7eg.jpeg"},"navItems":[{"__typename":"NavItem","title":"Machine Learning","url":"https:\u002F\u002Finstagram-engineering.com\u002Ftagged\u002Fmachine-learning","type":"TAG_NAV_ITEM"},{"__typename":"NavItem","title":"Android","url":"https:\u002F\u002Finstagram-engineering.com\u002Ftagged\u002Fandroid","type":"TAG_NAV_ITEM"},{"__typename":"NavItem","title":"iOS","url":"https:\u002F\u002Finstagram-engineering.com\u002Ftagged\u002Fios","type":"TAG_NAV_ITEM"},{"__typename":"NavItem","title":"Infrastructure","url":"https:\u002F\u002Finstagram-engineering.com\u002Ftagged\u002Finfrastructure","type":"TAG_NAV_ITEM"},{"__typename":"NavItem","title":"Data","url":"https:\u002F\u002Finstagram-engineering.com\u002Ftagged\u002Fdata","type":"TAG_NAV_ITEM"},{"__typename":"NavItem","title":"Open Source","url":"https:\u002F\u002Finstagram-engineering.com\u002Ftagged\u002Fopen-source","type":"TAG_NAV_ITEM"},{"__typename":"NavItem","title":"Team","url":"https:\u002F\u002Finstagram-engineering.com\u002Ftagged\u002Fteam","type":"TAG_NAV_ITEM"},{"__typename":"NavItem","title":"View All Posts","url":"https:\u002F\u002Fengineering.instagram.com\u002Flatest","type":"EXTERNAL_LINK_NAV_ITEM"}],"creator":{"__ref":"User:a4c6efa67fe0"},"subscriberCount":22545,"avatar":{"__ref":"ImageMetadata:1*CPgwLHR6jno_tOmF0--7eg.jpeg"},"isEnrolledInHightower":false,"newsletterV3":null,"viewerIsFollowing":false,"viewerIsSubscribedToLetters":false,"canToggleEmail":false,"isUserSubscribedToCollectionEmails":false,"viewerIsMuting":false,"viewerCanEditOwnPosts":false,"viewerCanEditPosts":false,"description":"Stories from the people who build @Instagram","ampEnabled":false,"twitterUsername":"instagrameng","facebookPageId":null},"Paragraph:5f7306cf6c41_0":{"id":"5f7306cf6c41_0","__typename":"Paragraph","name":"e3d5","text":"Sharding & IDs at Instagram","type":"H3","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:5f7306cf6c41_1":{"id":"5f7306cf6c41_1","__typename":"Paragraph","name":"da79","text":"With more than 25 photos and 90 likes every second, we store a lot of data here at Instagram. To make sure all of our important data fits into memory and is available quickly for our users, we’ve begun to shard our data — in other words, place the data in many smaller buckets, each holding a part of the data.","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":205,"end":210,"type":"A","href":"http:\u002F\u002Fwww.facebook.com\u002Fl.php?u=http%3A%2F%2Fen.wikipedia.org%2Fwiki%2FShard_%28database%29&h=lAQHFITrt&s=1","anchorType":"LINK","userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:5f7306cf6c41_2":{"id":"5f7306cf6c41_2","__typename":"Paragraph","name":"bfba","text":"Our application servers run Django with PostgreSQL as our back-end database. Our first question after deciding to shard out our data was whether PostgreSQL should remain our primary data-store, or whether we should switch to something else. We evaluated a few different NoSQL solutions, but ultimately decided that the solution that best suited our needs would be to shard our data across a set of PostgreSQL servers.","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":28,"end":34,"type":"A","href":"http:\u002F\u002Fwww.facebook.com\u002Fl.php?u=http%3A%2F%2Fdjangoproject.com%2F&h=sAQHcqWJT&s=1","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","start":40,"end":50,"type":"A","href":"http:\u002F\u002Fwww.facebook.com\u002Fl.php?u=http%3A%2F%2Fpostgresql.org%2F&h=iAQGuql57&s=1","anchorType":"LINK","userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:5f7306cf6c41_3":{"id":"5f7306cf6c41_3","__typename":"Paragraph","name":"6dec","text":"Before writing data into this set of servers, however, we had to solve the issue of how to assign unique identifiers to each piece of data in the database (for example, each photo posted in our system). The typical solution that works for a single database — just using a database’s natural auto-incrementing primary key feature — no longer works when data is being inserted into many databases at the same time. The rest of this blog post addresses how we tackled this issue.","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:5f7306cf6c41_4":{"id":"5f7306cf6c41_4","__typename":"Paragraph","name":"33d5","text":"Before starting out, we listed out what features were essential in our system:","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:5f7306cf6c41_5":{"id":"5f7306cf6c41_5","__typename":"Paragraph","name":"1012","text":"Generated IDs should be sortable by time (so a list of photo IDs, for example, could be sorted without fetching more information about the photos)","type":"OLI","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:5f7306cf6c41_6":{"id":"5f7306cf6c41_6","__typename":"Paragraph","name":"4d7d","text":"IDs should ideally be 64 bits (for smaller indexes, and better storage in systems like Redis)","type":"OLI","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:5f7306cf6c41_7":{"id":"5f7306cf6c41_7","__typename":"Paragraph","name":"be99","text":"The system should introduce as few new ‘moving parts’ as possible — a large part of how we’ve been able to scale Instagram with very few engineers is by choosing simple, easy-to-understand solutions that we trust.","type":"OLI","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:5f7306cf6c41_8":{"id":"5f7306cf6c41_8","__typename":"Paragraph","name":"70ef","text":"Existing solutions","type":"H3","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:5f7306cf6c41_9":{"id":"5f7306cf6c41_9","__typename":"Paragraph","name":"b933","text":"Many existing solutions to the ID generation problem exist; here are a few we considered:","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:5f7306cf6c41_10":{"id":"5f7306cf6c41_10","__typename":"Paragraph","name":"60a6","text":"Generate IDs in web application","type":"H4","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:5f7306cf6c41_11":{"id":"5f7306cf6c41_11","__typename":"Paragraph","name":"c629","text":"This approach leaves ID generation entirely up to your application, and not up to the database at all. For example, MongoDB’s ObjectId, which is 12 bytes long and encodes the timestamp as the first component. Another popular approach is to use UUIDs.","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":116,"end":134,"type":"A","href":"http:\u002F\u002Fwww.facebook.com\u002Fl.php?u=http%3A%2F%2Fwww.mongodb.org%2Fdisplay%2FDOCS%2FObject%2BIDs&h=fAQFgEvBI&s=1","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","start":244,"end":249,"type":"A","href":"http:\u002F\u002Fwww.facebook.com\u002Fl.php?u=http%3A%2F%2Fen.wikipedia.org%2Fwiki%2FUniversally_unique_identifier&h=MAQFZAMfT&s=1","anchorType":"LINK","userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:5f7306cf6c41_12":{"id":"5f7306cf6c41_12","__typename":"Paragraph","name":"cac7","text":"Pros:","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":0,"end":5,"type":"STRONG","href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:5f7306cf6c41_13":{"id":"5f7306cf6c41_13","__typename":"Paragraph","name":"825c","text":"Each application thread generates IDs independently, minimizing points of failure and contention for ID generation","type":"OLI","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:5f7306cf6c41_14":{"id":"5f7306cf6c41_14","__typename":"Paragraph","name":"8e47","text":"If you use a timestamp as the first component of the ID, the IDs remain time-sortable","type":"OLI","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:5f7306cf6c41_15":{"id":"5f7306cf6c41_15","__typename":"Paragraph","name":"78ab","text":"Cons:","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":0,"end":5,"type":"STRONG","href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:5f7306cf6c41_16":{"id":"5f7306cf6c41_16","__typename":"Paragraph","name":"3488","text":"Generally requires more storage space (96 bits or higher) to make reasonable uniqueness guarantees","type":"OLI","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:5f7306cf6c41_17":{"id":"5f7306cf6c41_17","__typename":"Paragraph","name":"132d","text":"Some UUID types are completely random and have no natural sort","type":"OLI","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:5f7306cf6c41_18":{"id":"5f7306cf6c41_18","__typename":"Paragraph","name":"1dfc","text":"Generate IDs through dedicated service","type":"H4","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:5f7306cf6c41_19":{"id":"5f7306cf6c41_19","__typename":"Paragraph","name":"18ec","text":"Ex: Twitter’s Snowflake, a Thrift service that uses Apache ZooKeeper to coordinate nodes and then generates 64-bit unique IDs","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":14,"end":23,"type":"A","href":"http:\u002F\u002Fwww.facebook.com\u002Fl.php?u=http%3A%2F%2Fgithub.com%2Ftwitter%2Fsnowflake%2F&h=9AQHsyMKM&s=1","anchorType":"LINK","userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:5f7306cf6c41_20":{"id":"5f7306cf6c41_20","__typename":"Paragraph","name":"56bb","text":"Pros:","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":0,"end":5,"type":"STRONG","href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:5f7306cf6c41_21":{"id":"5f7306cf6c41_21","__typename":"Paragraph","name":"57bf","text":"Snowflake IDs are 64-bits, half the size of a UUID","type":"OLI","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:5f7306cf6c41_22":{"id":"5f7306cf6c41_22","__typename":"Paragraph","name":"da49","text":"Can use time as first component and remain sortable","type":"OLI","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:5f7306cf6c41_23":{"id":"5f7306cf6c41_23","__typename":"Paragraph","name":"1754","text":"Distributed system that can survive nodes dying","type":"OLI","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:5f7306cf6c41_24":{"id":"5f7306cf6c41_24","__typename":"Paragraph","name":"6714","text":"Cons:","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":0,"end":5,"type":"STRONG","href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:5f7306cf6c41_25":{"id":"5f7306cf6c41_25","__typename":"Paragraph","name":"4ec6","text":"Would introduce additional complexity and more ‘moving parts’ (ZooKeeper, Snowflake servers) into our architecture","type":"OLI","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:5f7306cf6c41_26":{"id":"5f7306cf6c41_26","__typename":"Paragraph","name":"360d","text":"DB Ticket Servers","type":"H4","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:5f7306cf6c41_27":{"id":"5f7306cf6c41_27","__typename":"Paragraph","name":"1ed8","text":"Uses the database’s auto-incrementing abilities to enforce uniqueness. Flickr uses this approach, but with two ticket DBs (one on odd numbers, the other on even) to avoid a single point of failure.","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":71,"end":96,"type":"A","href":"http:\u002F\u002Fwww.facebook.com\u002Fl.php?u=http%3A%2F%2Fcode.flickr.com%2Fblog%2F2010%2F02%2F08%2Fticket-servers-distributed-unique-primary-keys-on-the-cheap%2F&h=xAQEgbGg0&s=1","anchorType":"LINK","userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:5f7306cf6c41_28":{"id":"5f7306cf6c41_28","__typename":"Paragraph","name":"21fa","text":"Pros:","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":0,"end":5,"type":"STRONG","href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:5f7306cf6c41_29":{"id":"5f7306cf6c41_29","__typename":"Paragraph","name":"2efa","text":"DBs are well understood and have pretty predictable scaling factors","type":"OLI","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:5f7306cf6c41_30":{"id":"5f7306cf6c41_30","__typename":"Paragraph","name":"1cfc","text":"Cons:","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":0,"end":5,"type":"STRONG","href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:5f7306cf6c41_31":{"id":"5f7306cf6c41_31","__typename":"Paragraph","name":"5459","text":"Can eventually become a write bottleneck (though Flickr reports that, even at huge scale, it’s not an issue).","type":"OLI","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:5f7306cf6c41_32":{"id":"5f7306cf6c41_32","__typename":"Paragraph","name":"f344","text":"An additional couple of machines (or EC2 instances) to admin","type":"OLI","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:5f7306cf6c41_33":{"id":"5f7306cf6c41_33","__typename":"Paragraph","name":"ad41","text":"If using a single DB, becomes single point of failure. If using multiple DBs, can no longer guarantee that they are sortable over time.","type":"OLI","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:5f7306cf6c41_34":{"id":"5f7306cf6c41_34","__typename":"Paragraph","name":"1ed1","text":"Of all the approaches above, Twitter’s Snowflake came the closest, but the additional complexity required to run an ID service was a point against it. Instead, we took a conceptually similar approach, but brought it inside PostgreSQL.","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:5f7306cf6c41_35":{"id":"5f7306cf6c41_35","__typename":"Paragraph","name":"4c60","text":"Our solution","type":"H3","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:5f7306cf6c41_36":{"id":"5f7306cf6c41_36","__typename":"Paragraph","name":"058c","text":"Our sharded system consists of several thousand ‘logical’ shards that are mapped in code to far fewer physical shards. Using this approach, we can start with just a few database servers, and eventually move to many more, simply by moving a set of logical shards from one database to another, without having to re-bucket any of our data. We used Postgres’ schemas feature to make this easy to script and administrate.","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:5f7306cf6c41_37":{"id":"5f7306cf6c41_37","__typename":"Paragraph","name":"a766","text":"Schemas (not to be confused with the SQL schema of an individual table) are a logical grouping feature in Postgres. Each Postgres DB can h2have several schemas, each of which can contain one or more tables. Table names must only be unique per-schema, not per-DB, and by default Postgres places everything in a schema named ‘public’.","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:5f7306cf6c41_38":{"id":"5f7306cf6c41_38","__typename":"Paragraph","name":"2f83","text":"Each ‘logical’ shard is a Postgres schema in our system, and each sharded table (for example, likes on our photos) exists inside each schema.","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:5f7306cf6c41_39":{"id":"5f7306cf6c41_39","__typename":"Paragraph","name":"722a","text":"We’ve delegated ID creation to each table inside each shard, by using PL\u002FPGSQL, Postgres’ internal programming language, and Postgres’ existing auto-increment functionality.","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:5f7306cf6c41_40":{"id":"5f7306cf6c41_40","__typename":"Paragraph","name":"b78f","text":"Each of our IDs consists of:","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:5f7306cf6c41_41":{"id":"5f7306cf6c41_41","__typename":"Paragraph","name":"8172","text":"41 bits for time in milliseconds (gives us 41 years of IDs with a custom epoch)","type":"ULI","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:5f7306cf6c41_42":{"id":"5f7306cf6c41_42","__typename":"Paragraph","name":"c457","text":"13 bits that represent the logical shard ID","type":"ULI","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:5f7306cf6c41_43":{"id":"5f7306cf6c41_43","__typename":"Paragraph","name":"55d4","text":"10 bits that represent an auto-incrementing sequence, modulus 1024. This means we can generate 1024 IDs, per shard, per millisecond","type":"ULI","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:5f7306cf6c41_44":{"id":"5f7306cf6c41_44","__typename":"Paragraph","name":"ddb7","text":"Let’s walk through an example: let’s say it’s September 9th, 2011, at 5:00pm and our ‘epoch’ begins on January 1st, 2011. There have been 1387263000 milliseconds since the beginning of our epoch, so to start our ID, we fill the left-most 41 bits with this value with a left-shift:","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:5f7306cf6c41_45":{"id":"5f7306cf6c41_45","__typename":"Paragraph","name":"9940","text":"id = 1387263000 \u003C\u003C(64-41)","type":"PRE","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:5f7306cf6c41_46":{"id":"5f7306cf6c41_46","__typename":"Paragraph","name":"f8be","text":"Next, we take the shard ID for this particular piece of data we’re trying to insert. Let’s say we’re sharding by user ID, and there are 2000 logical shards; if our user ID is 31341, then the shard ID is 31341 % 2000 -\u003E 1341. We fill the next 13 bits with this value:","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:5f7306cf6c41_47":{"id":"5f7306cf6c41_47","__typename":"Paragraph","name":"d0ff","text":"id |= 1341 \u003C\u003C(64-41-13)","type":"PRE","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:5f7306cf6c41_48":{"id":"5f7306cf6c41_48","__typename":"Paragraph","name":"983e","text":"Finally, we take whatever the next value of our auto-increment sequence (this sequence is unique to each table in each schema) and fill out the remaining bits. Let’s say we’d generated 5,000 IDs for this table already; our next value is 5,001, which we take and mod by 1024 (so it fits in 10 bits) and include it too:","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:5f7306cf6c41_49":{"id":"5f7306cf6c41_49","__typename":"Paragraph","name":"1364","text":"id |= (5001 % 1024)","type":"PRE","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:5f7306cf6c41_50":{"id":"5f7306cf6c41_50","__typename":"Paragraph","name":"1ed9","text":"We now have our ID, which we can return to the application server using the RETURNING keyword as part of the INSERT.","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:5f7306cf6c41_51":{"id":"5f7306cf6c41_51","__typename":"Paragraph","name":"ff0d","text":"Here’s the PL\u002FPGSQL that accomplishes all this (for an example schema insta5):","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:5f7306cf6c41_52":{"id":"5f7306cf6c41_52","__typename":"Paragraph","name":"fc17","text":"CREATE OR REPLACE FUNCTION insta5.next_id(OUT result bigint) AS $$\nDECLARE\n    our_epoch bigint := 1314220021721;\n    seq_id bigint;\n    now_millis bigint;\n    shard_id int := 5;\nBEGIN\n    SELECT nextval('insta5.table_id_seq') %% 1024 INTO seq_id;","type":"PRE","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:5f7306cf6c41_53":{"id":"5f7306cf6c41_53","__typename":"Paragraph","name":"9622","text":"    SELECT FLOOR(EXTRACT(EPOCH FROM clock_timestamp()) * 1000) INTO now_millis;\n    result := (now_millis - our_epoch) \u003C\u003C 23;\n    result := result | (shard_id \u003C\u003C10);\n    result := result | (seq_id);\nEND;\n    $$ LANGUAGE PLPGSQL;","type":"PRE","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:5f7306cf6c41_54":{"id":"5f7306cf6c41_54","__typename":"Paragraph","name":"c828","text":"And when creating the table, we do:","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:5f7306cf6c41_55":{"id":"5f7306cf6c41_55","__typename":"Paragraph","name":"f4da","text":"CREATE TABLE insta5.our_table (\n    \"id\" bigint NOT NULL DEFAULT insta5.next_id(),\n    ...rest of table schema...\n  )","type":"PRE","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[],"dropCapImage":null},"Paragraph:5f7306cf6c41_56":{"id":"5f7306cf6c41_56","__typename":"Paragraph","name":"33af","text":"And that’s it! Primary keys that are unique across our application (and as a bonus, contain the shard ID in them for easier mapping). We’ve been rolling this approach into production and are happy with the results so far. Interested in helping us figure out these problems at scale? We’re hiring!","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":283,"end":296,"type":"A","href":"http:\u002F\u002Fwww.facebook.com\u002Fl.php?u=http%3A%2F%2Finstagram.com%2Fabout%2Fjobs%2F&h=MAQFZAMfT&s=1","anchorType":"LINK","userId":null,"linkMetadata":null}],"dropCapImage":null},"Paragraph:5f7306cf6c41_57":{"id":"5f7306cf6c41_57","__typename":"Paragraph","name":"f3ef","text":"Discuss this post on Hacker News.","type":"P","href":null,"layout":null,"metadata":null,"hasDropCap":null,"iframe":null,"mixtapeMetadata":null,"markups":[{"__typename":"Markup","start":21,"end":32,"type":"A","href":"http:\u002F\u002Fwww.facebook.com\u002Fl.php?u=http%3A%2F%2Fnews.ycombinator.com%2Fitem%3Fid%3D3058327&h=AAQGg9bLp&s=1","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","start":0,"end":33,"type":"EM","href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"dropCapImage":null},"Tag:infra":{"id":"infra","__typename":"Tag","displayTitle":"Infra"},"Tag:open-source":{"id":"open-source","__typename":"Tag","displayTitle":"Open Source"},"User:5e0a667af143":{"id":"5e0a667af143","__typename":"User","name":"Carl Meyer","username":"carlmeyer","bio":"","isFollowing":false,"imageId":"0*7v4Wmt5KJWgWxnvZ.","mediumMemberAt":0,"hasDomain":false},"Post:c0bb9245c834":{"id":"c0bb9245c834","__typename":"Post","title":"Python at Scale: Strict Modules","mediumUrl":"https:\u002F\u002Finstagram-engineering.com\u002Fpython-at-scale-strict-modules-c0bb9245c834","previewImage":{"__ref":"ImageMetadata:"},"isPublished":true,"firstPublishedAt":1571324466849,"readingTime":8.426415094339623,"statusForCollection":"APPROVED","isLocked":false,"isShortform":false,"visibility":"PUBLIC","collection":{"__ref":"Collection:37dc2a3034f2"},"creator":{"__ref":"User:5e0a667af143"},"previewContent":{"__typename":"PreviewContent","isFullContent":false}},"ImageMetadata:1*madjA8Cbk-QVS--NyR5Q3g.png":{"id":"1*madjA8Cbk-QVS--NyR5Q3g.png","__typename":"ImageMetadata","focusPercentX":null,"focusPercentY":null},"User:176d0a02f80b":{"id":"176d0a02f80b","__typename":"User","name":"Glenn Conner","username":"mr_sharpoblunto","bio":"Interested in games, art, technology, and distributing the future.","isFollowing":false,"imageId":"0*w7Dexcjl8a_rHczk.png","mediumMemberAt":0,"hasDomain":false},"Post:62cc0c327538":{"id":"62cc0c327538","__typename":"Post","title":"Making Instagram.com faster: Part 1","mediumUrl":"https:\u002F\u002Finstagram-engineering.com\u002Fmaking-instagram-com-faster-part-1-62cc0c327538","previewImage":{"__ref":"ImageMetadata:1*madjA8Cbk-QVS--NyR5Q3g.png"},"isPublished":true,"firstPublishedAt":1564678216536,"readingTime":7.30377358490566,"statusForCollection":"APPROVED","isLocked":false,"isShortform":false,"visibility":"PUBLIC","collection":{"__ref":"Collection:37dc2a3034f2"},"creator":{"__ref":"User:176d0a02f80b"},"previewContent":{"__typename":"PreviewContent","isFullContent":false}},"ImageMetadata:1*J7MSYdDO3yEz09sGE6yRTA.png":{"id":"1*J7MSYdDO3yEz09sGE6yRTA.png","__typename":"ImageMetadata","focusPercentX":null,"focusPercentY":null},"User:c2c4e2d18e0b":{"id":"c2c4e2d18e0b","__typename":"User","name":"Benjamin Woodruff","username":"bgw","bio":"","isFollowing":false,"imageId":"2*8SKA6RZTRHyFQeoOMOd40Q.jpeg","mediumMemberAt":0,"hasDomain":false},"Post:8f498ab71a0c":{"id":"8f498ab71a0c","__typename":"Post","title":"Static Analysis at Scale: An Instagram Story","mediumUrl":"https:\u002F\u002Finstagram-engineering.com\u002Fstatic-analysis-at-scale-an-instagram-story-8f498ab71a0c","previewImage":{"__ref":"ImageMetadata:1*J7MSYdDO3yEz09sGE6yRTA.png"},"isPublished":true,"firstPublishedAt":1565897801419,"readingTime":12.459433962264152,"statusForCollection":"APPROVED","isLocked":false,"isShortform":false,"visibility":"PUBLIC","collection":{"__ref":"Collection:37dc2a3034f2"},"creator":{"__ref":"User:c2c4e2d18e0b"},"previewContent":{"__typename":"PreviewContent","isFullContent":false}},"ImageMetadata:1*NGABlwJjUR2g0T23xTvWoQ.png":{"id":"1*NGABlwJjUR2g0T23xTvWoQ.png","__typename":"ImageMetadata","focusPercentX":null,"focusPercentY":null},"Post:6f3f130b9669":{"id":"6f3f130b9669","__typename":"Post","title":"Making instagram.com faster: Part 3 — cache first","mediumUrl":"https:\u002F\u002Finstagram-engineering.com\u002Fmaking-instagram-com-faster-part-3-cache-first-6f3f130b9669","previewImage":{"__ref":"ImageMetadata:1*NGABlwJjUR2g0T23xTvWoQ.png"},"isPublished":true,"firstPublishedAt":1570752266097,"readingTime":4.081446540880504,"statusForCollection":"APPROVED","isLocked":true,"isShortform":false,"visibility":"LOCKED","collection":{"__ref":"Collection:37dc2a3034f2"},"creator":{"__ref":"User:176d0a02f80b"},"previewContent":{"__typename":"PreviewContent","isFullContent":false}},"ImageMetadata:1*nN1d8smYVl_pBPUdcowtEg.png":{"id":"1*nN1d8smYVl_pBPUdcowtEg.png","__typename":"ImageMetadata","focusPercentX":null,"focusPercentY":null},"User:1206c7a0a9c0":{"id":"1206c7a0a9c0","__typename":"User","name":"Anirudh Padmarao","username":"apadmarao","bio":"Infrastructure @ Instagram","isFollowing":false,"imageId":"2*A41FCLj4-QRUeFDtMAoinw.jpeg","mediumMemberAt":0,"hasDomain":false},"Post:d3c3a207fdb7":{"id":"d3c3a207fdb7","__typename":"Post","title":"Types for Python HTTP APIs: An Instagram Story","mediumUrl":"https:\u002F\u002Finstagram-engineering.com\u002Ftypes-for-python-http-apis-an-instagram-story-d3c3a207fdb7","previewImage":{"__ref":"ImageMetadata:1*nN1d8smYVl_pBPUdcowtEg.png"},"isPublished":true,"firstPublishedAt":1568400266366,"readingTime":7.956918238993711,"statusForCollection":"APPROVED","isLocked":true,"isShortform":false,"visibility":"LOCKED","collection":{"__ref":"Collection:37dc2a3034f2"},"creator":{"__ref":"User:1206c7a0a9c0"},"previewContent":{"__typename":"PreviewContent","isFullContent":false}},"ImageMetadata:1*HDLCFPZCIfOpVWMSYz4HOg.png":{"id":"1*HDLCFPZCIfOpVWMSYz4HOg.png","__typename":"ImageMetadata","focusPercentX":null,"focusPercentY":null},"Post:57668be796a8":{"id":"57668be796a8","__typename":"Post","title":"Making instagram.com faster: Code size and execution optimizations (Part 4)","mediumUrl":"https:\u002F\u002Finstagram-engineering.com\u002Fmaking-instagram-com-faster-code-size-and-execution-optimizations-part-4-57668be796a8","previewImage":{"__ref":"ImageMetadata:1*HDLCFPZCIfOpVWMSYz4HOg.png"},"isPublished":true,"firstPublishedAt":1572613392297,"readingTime":6.999056603773585,"statusForCollection":"APPROVED","isLocked":false,"isShortform":false,"visibility":"PUBLIC","collection":{"__ref":"Collection:37dc2a3034f2"},"creator":{"__ref":"User:176d0a02f80b"},"previewContent":{"__typename":"PreviewContent","isFullContent":false}},"ImageMetadata:0*s8g4LHW_M5OfTrU_":{"id":"0*s8g4LHW_M5OfTrU_","__typename":"ImageMetadata","focusPercentX":null,"focusPercentY":null},"User:175f8a897c16":{"id":"175f8a897c16","__typename":"User","name":"Nick Cooper","username":"nickmvcooper","bio":"","isFollowing":false,"imageId":"1*QWQIgo37fw22YCInBUf7Wg.jpeg","mediumMemberAt":0,"hasDomain":false},"Post:82191c8af57d":{"id":"82191c8af57d","__typename":"Post","title":"Thundering Herds & Promises","mediumUrl":"https:\u002F\u002Finstagram-engineering.com\u002Fthundering-herds-promises-82191c8af57d","previewImage":{"__ref":"ImageMetadata:0*s8g4LHW_M5OfTrU_"},"isPublished":true,"firstPublishedAt":1555433854956,"readingTime":4.239622641509434,"statusForCollection":"APPROVED","isLocked":false,"isShortform":false,"visibility":"PUBLIC","collection":{"__ref":"Collection:37dc2a3034f2"},"creator":{"__ref":"User:175f8a897c16"},"previewContent":{"__typename":"PreviewContent","isFullContent":false}},"ImageMetadata:1*PaVxVUG89fMe9KTc-L8dew.jpeg":{"id":"1*PaVxVUG89fMe9KTc-L8dew.jpeg","__typename":"ImageMetadata","focusPercentX":null,"focusPercentY":null},"Post:89d4cbeeb898":{"id":"89d4cbeeb898","__typename":"Post","title":"Profiling CPython at Instagram","mediumUrl":"https:\u002F\u002Finstagram-engineering.com\u002Fprofiling-cpython-at-instagram-89d4cbeeb898","previewImage":{"__ref":"ImageMetadata:1*PaVxVUG89fMe9KTc-L8dew.jpeg"},"isPublished":true,"firstPublishedAt":1510938288002,"readingTime":5.10503144654088,"statusForCollection":"APPROVED","isLocked":false,"isShortform":false,"visibility":"PUBLIC","collection":{"__ref":"Collection:37dc2a3034f2"},"creator":{"__ref":"User:a4c6efa67fe0"},"previewContent":{"__typename":"PreviewContent","isFullContent":false}},"Post:1cf5a71e5a5c":{"id":"1cf5a71e5a5c","__typename":"Post","canonicalUrl":"","collection":{"__ref":"Collection:37dc2a3034f2"},"content({\"postMeteringOptions\":{}})":{"__typename":"PostContent","isLockedPreviewOnly":false,"validatedShareKey":"","isCacheableContent":false,"bodyModel":{"__typename":"RichText","paragraphs":[{"__ref":"Paragraph:5f7306cf6c41_0"},{"__ref":"Paragraph:5f7306cf6c41_1"},{"__ref":"Paragraph:5f7306cf6c41_2"},{"__ref":"Paragraph:5f7306cf6c41_3"},{"__ref":"Paragraph:5f7306cf6c41_4"},{"__ref":"Paragraph:5f7306cf6c41_5"},{"__ref":"Paragraph:5f7306cf6c41_6"},{"__ref":"Paragraph:5f7306cf6c41_7"},{"__ref":"Paragraph:5f7306cf6c41_8"},{"__ref":"Paragraph:5f7306cf6c41_9"},{"__ref":"Paragraph:5f7306cf6c41_10"},{"__ref":"Paragraph:5f7306cf6c41_11"},{"__ref":"Paragraph:5f7306cf6c41_12"},{"__ref":"Paragraph:5f7306cf6c41_13"},{"__ref":"Paragraph:5f7306cf6c41_14"},{"__ref":"Paragraph:5f7306cf6c41_15"},{"__ref":"Paragraph:5f7306cf6c41_16"},{"__ref":"Paragraph:5f7306cf6c41_17"},{"__ref":"Paragraph:5f7306cf6c41_18"},{"__ref":"Paragraph:5f7306cf6c41_19"},{"__ref":"Paragraph:5f7306cf6c41_20"},{"__ref":"Paragraph:5f7306cf6c41_21"},{"__ref":"Paragraph:5f7306cf6c41_22"},{"__ref":"Paragraph:5f7306cf6c41_23"},{"__ref":"Paragraph:5f7306cf6c41_24"},{"__ref":"Paragraph:5f7306cf6c41_25"},{"__ref":"Paragraph:5f7306cf6c41_26"},{"__ref":"Paragraph:5f7306cf6c41_27"},{"__ref":"Paragraph:5f7306cf6c41_28"},{"__ref":"Paragraph:5f7306cf6c41_29"},{"__ref":"Paragraph:5f7306cf6c41_30"},{"__ref":"Paragraph:5f7306cf6c41_31"},{"__ref":"Paragraph:5f7306cf6c41_32"},{"__ref":"Paragraph:5f7306cf6c41_33"},{"__ref":"Paragraph:5f7306cf6c41_34"},{"__ref":"Paragraph:5f7306cf6c41_35"},{"__ref":"Paragraph:5f7306cf6c41_36"},{"__ref":"Paragraph:5f7306cf6c41_37"},{"__ref":"Paragraph:5f7306cf6c41_38"},{"__ref":"Paragraph:5f7306cf6c41_39"},{"__ref":"Paragraph:5f7306cf6c41_40"},{"__ref":"Paragraph:5f7306cf6c41_41"},{"__ref":"Paragraph:5f7306cf6c41_42"},{"__ref":"Paragraph:5f7306cf6c41_43"},{"__ref":"Paragraph:5f7306cf6c41_44"},{"__ref":"Paragraph:5f7306cf6c41_45"},{"__ref":"Paragraph:5f7306cf6c41_46"},{"__ref":"Paragraph:5f7306cf6c41_47"},{"__ref":"Paragraph:5f7306cf6c41_48"},{"__ref":"Paragraph:5f7306cf6c41_49"},{"__ref":"Paragraph:5f7306cf6c41_50"},{"__ref":"Paragraph:5f7306cf6c41_51"},{"__ref":"Paragraph:5f7306cf6c41_52"},{"__ref":"Paragraph:5f7306cf6c41_53"},{"__ref":"Paragraph:5f7306cf6c41_54"},{"__ref":"Paragraph:5f7306cf6c41_55"},{"__ref":"Paragraph:5f7306cf6c41_56"},{"__ref":"Paragraph:5f7306cf6c41_57"}],"sections":[{"__typename":"Section","name":"bd56","startIndex":0,"textLayout":null,"imageLayout":null,"backgroundImage":null,"videoLayout":null,"backgroundVideo":null}]}},"creator":{"__ref":"User:a4c6efa67fe0"},"customStyleSheet":null,"firstPublishedAt":1356866580000,"isLocked":false,"isPublished":true,"isShortform":false,"layerCake":0,"primaryTopic":null,"title":"Sharding & IDs at Instagram","readCreatorPostsCount":0,"mediumUrl":"https:\u002F\u002Finstagram-engineering.com\u002Fsharding-ids-at-instagram-1cf5a71e5a5c","isLimitedState":false,"visibility":"PUBLIC","license":"ALL_RIGHTS_RESERVED","allowResponses":true,"newsletterId":"","sequence":null,"tags":[{"__ref":"Tag:infra"},{"__ref":"Tag:open-source"}],"topics":[],"viewerClapCount":0,"showSubscribeToProfilePromo":false,"showSubscribeToCollectionNewsletterV3Promo":false,"inResponseToPostResult":null,"isNewsletter":false,"socialTitle":"","socialDek":"","metaDescription":"","latestPublishedAt":1462214169745,"readingTime":4.611320754716981,"previewContent":{"__typename":"PreviewContent","subtitle":"With more than 25 photos and 90 likes every second, we store a lot of data here at Instagram. To make sure all of our important data fits…"},"previewImage":{"__ref":"ImageMetadata:"},"creatorPartnerProgramEnrollmentStatus":"PERMISSION_DENIED","clapCount":3888,"lockedSource":"LOCKED_POST_SOURCE_NONE","isSuspended":false,"pendingCollection":null,"statusForCollection":"APPROVED","pinnedAt":0,"pinnedByCreatorAt":0,"curationEligibleAt":0,"shareKey":null,"internalLinks({\"paging\":{\"limit\":8}})":{"__typename":"InternalLinksConnection","items":[{"__ref":"Post:c0bb9245c834"},{"__ref":"Post:62cc0c327538"},{"__ref":"Post:8f498ab71a0c"},{"__ref":"Post:6f3f130b9669"},{"__ref":"Post:d3c3a207fdb7"},{"__ref":"Post:57668be796a8"},{"__ref":"Post:82191c8af57d"},{"__ref":"Post:89d4cbeeb898"}]},"collaborators":[],"translationSourcePost":null,"inResponseToMediaResource":null,"isDistributionAlertDismissed":false,"audioVersionUrl":"","seoTitle":"","updatedAt":1529377973551,"shortformType":"SHORTFORM_TYPE_LINK","structuredData":"","seoDescription":"","postResponses":{"__typename":"PostResponses","count":28},"latestPublishedVersion":"5f7306cf6c41","isPublishToEmail":false,"readingList":"READING_LIST_NONE","voterCount":840,"recommenders":[]}}</script><script src="https://cdn-client.medium.com/lite/static/js/manifest.5c638f83.js"></script><script src="https://cdn-client.medium.com/lite/static/js/9288.279f6c68.js"></script><script src="https://cdn-client.medium.com/lite/static/js/main.03e83a6f.js"></script><script src="https://cdn-client.medium.com/lite/static/js/5573.159bf40f.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/instrumentation.a4f4dad9.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/reporting.54526183.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/1752.a348f767.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/4464.c01c0ad8.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/8342.6aa0b45e.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/1148.fddd1e85.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/9692.88890f19.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/5064.c5304734.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/9274.431d8f19.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/2846.ced8d265.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/7012.3fbb11ee.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/7993.113d64ba.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/6839.2f3b0813.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/5127.a7002b91.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/5967.75eb788b.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/8751.53fa9af5.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/6010.8dc46cb3.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/7131.7d7cda9d.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/8127.86421bad.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/463.ef57f5c7.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/1373.832e5ac7.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/587.7c3ddf2e.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/2514.597d2c66.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/2602.c12dc7bb.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/857.5e5e8e75.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/8286.08280ee0.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/5429.151f1221.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/8831.8e70de8b.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/3981.35b146f3.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/Post.008fa8f5.chunk.js"></script><script>window.main();</script></body></html>